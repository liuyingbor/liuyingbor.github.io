<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Unity-网络开发（二） | 狼唤</title><meta name="author" content="刘英博"><meta name="copyright" content="刘英博"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="网络通信网络游戏通信方案概述弱联网和强联网游戏网络游戏是以C&#x2F;S模型为基础进行开发的由客户端和服务端组成 弱联网游戏： 这种游戏不会频繁的进行数据通信，客户端和服务端之间每次连接只处理一次请求，服务端处理完客户端的请求后返回数据后就断开连接了 强联网游戏： 这种游戏会频繁的和服务端进行通信，会一直和服务端保持连接状态，不停的和服务器之间交换数据通过之前的知识我们知道，网络游戏是以C&#x2F;S模型为基础进"><meta property="og:type" content="article"><meta property="og:title" content="Unity-网络开发（二）"><meta property="og:url" content="https://liuyingbo.com/posts/f780d4d0.html"><meta property="og:site_name" content="狼唤"><meta property="og:description" content="网络通信网络游戏通信方案概述弱联网和强联网游戏网络游戏是以C&#x2F;S模型为基础进行开发的由客户端和服务端组成 弱联网游戏： 这种游戏不会频繁的进行数据通信，客户端和服务端之间每次连接只处理一次请求，服务端处理完客户端的请求后返回数据后就断开连接了 强联网游戏： 这种游戏会频繁的和服务端进行通信，会一直和服务端保持连接状态，不停的和服务器之间交换数据通过之前的知识我们知道，网络游戏是以C&#x2F;S模型为基础进"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png"><meta property="article:published_time" content="2022-05-16T15:06:06.000Z"><meta property="article:modified_time" content="2023-01-30T11:35:12.190Z"><meta property="article:author" content="刘英博"><meta property="article:tag" content="Unity"><meta property="article:tag" content="网络"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://liuyingbo.com/posts/f780d4d0"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#3b70fc"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Unity-网络开发（二）",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-01-30 11:35:12"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="css/color.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="狼唤" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211100000064.JPG" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-comment-dots"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i> <span>留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">狼唤</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-comment-dots"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i> <span>留言板</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Unity-网络开发（二）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-16T15:06:06.000Z" title="发表于 2022-05-16 15:06:06">2022-05-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-30T11:35:12.190Z" title="更新于 2023-01-30 11:35:12">2023-01-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Unity/">Unity</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Unity-网络开发（二）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="网络通信"><a href="#网络通信" class="headerlink" title="网络通信"></a>网络通信</h1><h2 id="网络游戏通信方案概述"><a href="#网络游戏通信方案概述" class="headerlink" title="网络游戏通信方案概述"></a>网络游戏通信方案概述</h2><h3 id="弱联网和强联网游戏"><a href="#弱联网和强联网游戏" class="headerlink" title="弱联网和强联网游戏"></a>弱联网和强联网游戏</h3><p>网络游戏是以C/S模型为基础进行开发的由客户端和服务端组成</p><p>弱联网游戏：</p><p>这种游戏不会频繁的进行数据通信，客户端和服务端之间每次连接只处理一次请求，服务端处理完客户端的请求后返回数据后就断开连接了</p><p>强联网游戏：</p><p>这种游戏会频繁的和服务端进行通信，会一直和服务端保持连接状态，不停的和服务器之间交换数据通过之前的知识我们知道，网络游戏是以C/S模型为基础进行开发的由客户端和服务端组成</p><p>弱联网游戏代表：</p><p>一般的三消类休闲游戏、卡牌游戏等都会是弱联网游戏，这些游戏的核心玩法都由客户端完成，客户端处理完成后只是告诉服务端一个结果，服务端验证结果即可，不需要随时通信</p><p>比如：开心消消乐、刀塔传奇、我叫MT等等</p><p>强联网游戏代表：</p><p>一般的MMORPG（角色扮演）、MOBA（多人在线竞技游戏）、ACT（动作游戏）等等都会是强联网游戏，这些游戏的部分核心逻辑是由服务端进行处理，客户端和服务端之间不停的在同步信息</p><p>比如：王者荣耀、守望先锋、和平精英等等</p><h3 id="长连接和短连接游戏"><a href="#长连接和短连接游戏" class="headerlink" title="长连接和短连接游戏"></a>长连接和短连接游戏</h3><p>长连接和短连接游戏是按照网络游戏通信特点来划分的</p><p>弱联网游戏——&gt;短连接游戏</p><p>强联网游戏——&gt;长连接游戏</p><p>短连接游戏：</p><p>需要传输数据时，建立连接，传输数据，获得响应，断开连接</p><p>通信特点：需要通信时再连接，通信完毕断开连接</p><p>通信方式：HTTP超文本传输协议、HTTPS安全的超文本传输协议（他们本质上是TCP协议）</p><p>长连接游戏：不管是否需要传输数据，客户端与服务器一直处于连接状态，除非一端主动断开，或</p><p>者出现意外情况（客户端关闭或服务端崩溃等）</p><p>通信特点：连接一直建立，可以实时的传输数据</p><p>通信方式：TCP传输控制协议 或 UDP用户数据报协议</p><h3 id="Socket、HTTP、FTP"><a href="#Socket、HTTP、FTP" class="headerlink" title="Socket、HTTP、FTP"></a>Socket、HTTP、FTP</h3><p>Socket：网络套接字，是对网络中不同主机上的应用进程之间进行双向通信的端点的抽象，一个套接字就是网络上进程通信的一端，提供了应用层进程利用网络协议交换数据的机制</p><p>主要用于制作长连接游戏（强联网游戏）</p><p>Http/Https：(安全的)超文本传输协议，是一个简单的请求-响应协议，它通常运行在TCP协议之上，它指定了客户端可能发送给服务端什么样的信息以及得到什么样的响应。</p><p>主要用于制作短连接游戏（弱联网游戏），也可以用来进行资源下载</p><p>FTP：文件传输协议，是用于在网络上进行文件传输的一套标准协议，可以利用它来进行网络上资源的下载和上传。它也是基于TCP的传输，是面向连接的，为文件传输提供了可靠的保证</p><h2 id="网络通信基础"><a href="#网络通信基础" class="headerlink" title="网络通信基础"></a>网络通信基础</h2><h3 id="IP地址和端口类"><a href="#IP地址和端口类" class="headerlink" title="IP地址和端口类"></a>IP地址和端口类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region IPAddress类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net;</span></span><br><span class="line"><span class="comment">//类名：IPAddress</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化IP信息的方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.用byte数组进行初始化</span></span><br><span class="line">byte[] ipAddress = <span class="keyword">new</span> byte[] &#123; <span class="number">118</span>, <span class="number">102</span>, <span class="number">111</span>, <span class="number">11</span> &#125;;</span><br><span class="line">IPAddress ip1 = <span class="keyword">new</span> <span class="built_in">IPAddress</span>(ipAddress);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.用long长整型进行初始化</span></span><br><span class="line"><span class="comment">//4字节对应的长整型 一般不建议大家使用</span></span><br><span class="line">IPAddress ip2 = <span class="keyword">new</span> <span class="built_in">IPAddress</span>(<span class="number">0x79666F0B</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.推荐使用的方式 使用字符串转换</span></span><br><span class="line">IPAddress ip3 = IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;118.102.111.11&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊IP地址</span></span><br><span class="line"><span class="comment">//127.0.0.1代表本机地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一些静态成员</span></span><br><span class="line"><span class="comment">//获取可用的IPv6地址</span></span><br><span class="line"><span class="comment">//IPAddress.IPv6Any</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region IPEndPoint类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net;</span></span><br><span class="line"><span class="comment">//类名：IPEndPoint</span></span><br><span class="line"><span class="comment">//IPEndPoint类将网络端点表示为IP地址和端口号，表现为IP地址和端口号的组合</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化方式</span></span><br><span class="line">IPEndPoint ipPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(<span class="number">0x79666F0B</span>, <span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">IPEndPoint ipPoint2 = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;118.102.111.11&quot;</span>), <span class="number">8080</span>);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//程序表示IP信息</span></span><br><span class="line">IPAddress ip = IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;IPv4地址&quot;</span>);</span><br><span class="line"><span class="comment">//程序表示通信目标</span></span><br><span class="line">IPEndPoint point = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(ip, <span class="number">8080</span>);</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>域名解析也叫域名指向、服务器设置、域名配置以及反向IP登记等等，说得简单点就是将好记的域名解析成IP，IP地址是网络上标识站点的数字地址，但是IP地址相对来说记忆困难，所以为了方便记忆，采用域名来代替IP地址标识站点地址。</p><p>比如 我们要登录一个网页 www.baidu.com 这个就是域名 我们可以通过记忆域名来记忆一个远端服务器的地址，而不是记录一个复杂的IP地址</p><p>域名解析就是域名到IP地址的转换过程。域名的解析工作由DNS服务器完成，我们在进行通信时有时会有需求通过域名获取IP</p><p>域名系统（英文：Domain Name System，缩写：DNS）是互联网的一项服务，它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网，是因特网上解决网上机器命名的一种系统，因为IP地址记忆不方便，就采用了域名系统来管理名字和IP的对应关系</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region IPHostEntry类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//类名：IPHostEntry</span></span><br><span class="line"><span class="comment">//主要作用：域名解析后的返回值 可以通过该对象获取IP地址、主机名等等信息</span></span><br><span class="line"><span class="comment">//该类不会自己声明，都是作为某些方法的返回值返回信息，我们主要通过该类对象获取返回的信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取关联IP       成员变量:AddressList</span></span><br><span class="line"><span class="comment">//获取主机别名列表  成员变量:Aliases</span></span><br><span class="line"><span class="comment">//获取DNS名称      成员变量:HostName</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region Dns类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//类名：Dns</span></span><br><span class="line"><span class="comment">//主要作用：Dns是一个静态类，提供了很多静态方法，可以使用它来根据域名获取IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//常用方法</span></span><br><span class="line"><span class="comment">//1.获取本地系统的主机名</span></span><br><span class="line"><span class="built_in">print</span>(Dns.<span class="built_in">GetHostName</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.获取指定域名的IP信息</span></span><br><span class="line"><span class="comment">//根据域名获取</span></span><br><span class="line"><span class="comment">//同步获取</span></span><br><span class="line"><span class="comment">//注意：由于获取远程主机信息是需要进行网路通信，所以可能会阻塞主线程</span></span><br><span class="line">IPHostEntry entry = Dns.<span class="built_in">GetHostEntry</span>(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; entry.AddressList.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;IP地址：&quot;</span> + entry.AddressList[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; entry.Aliases.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;主机别名&quot;</span> + entry.Aliases[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;DNS服务器名称&quot;</span> + entry.HostName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//异步获取</span></span><br><span class="line"><span class="built_in">GetHostEntry</span>();</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><p>如果不知道对方的IP地址，想通过域名和对方进行通信，可以通过Dns类通过域名得到IP地址后再和对方建立连接并通信</p><h3 id="序列化和反序列化2进制数据"><a href="#序列化和反序列化2进制数据" class="headerlink" title="序列化和反序列化2进制数据"></a>序列化和反序列化2进制数据</h3><h4 id="网络通信中传输的数据"><a href="#网络通信中传输的数据" class="headerlink" title="网络通信中传输的数据"></a>网络通信中传输的数据</h4><p>在网络通信中</p><p>把想要传递的类对象信息序列化为2进制数据（一般为byte字节数组）</p><p>再将该2进制数据通过网络传输给远端设备</p><p>远端设备获取到该2进制数据后再将其反序列化为对应的类对象</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242122585.png" alt="image-20220518003846852"></p><p>序列化：</p><p>将类对象信息转换为可保存或传输的格式的过程</p><p>反序列化：</p><p>与序列化相对，将保存或传输过来的格式转换为类对象的过程</p><p>比如</p><p>将C#类对象序列化为xml、json、2进制三种格式的数据保存在本地，达到持久化的目的，再将保存在本地的持久化数据文件反序列化为C#类对象</p><h4 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h4><p>字符编码（英语：Character encoding）也称字集码</p><p>是把字符集中的字符，编码为指定集合中某一对象，以便文本在计算机中存储或通过网络进行传递。</p><p><strong>说人话：计算机里只能存数字（2机制），所以如果文字字符想要进行存储的话，就需要把对应的文字字符转换为数字才能进行处理，而字符编码就是文字字符在计算机中和数值的对应关系，是人为定义的一种映射规则。</strong>比如</p><p>ASCII码（一种字符编码规则）中 数值65 用来映射 字符A</p><p>我们存储 A 这个字符，本质上存在内存中的是数值65对应的2进制是0100 0001</p><p>常见的一些字符编码规则有</p><p><strong>每个国家针对自己国家语言制定的编码规则（因为语言文字的数量各不相同）</strong></p><p><strong>ASCII码（美国）、GB2312编码（中国）、Shift_JIS编码（日本）、Euc-kr（韩国）等等</strong></p><p>世界通用的编码规则（把所有语言统一到一套编码里）</p><p><strong>Unicode编码 以及 基于Unicode实现的编码规则</strong></p><p><strong>UTF-8、UTF-16、UTF-32</strong></p><h4 id="乱码"><a href="#乱码" class="headerlink" title="乱码"></a>乱码</h4><p>假设我们的一个文件是采用中国制定的GB2312编码进行编辑存储的，而此时我们并不使用GB2312这个编码规则去读取文件，而是采用其它的规则，比如日本制定的Shift_JIS编码读取该文件，那么<strong>由于编码格式的存读不统一就会造成乱码的出现。因为不同的编码规则，字符和数值的映射关系是不同的。</strong></p><p>比如：130这个数值在法语编码中代表了<code>é</code>，在希伯来语编码中却代表了字母<code>Gimel</code> (<code>ג</code>)，在中文编码中又会代表另一个符号。</p><h4 id="ASCII码"><a href="#ASCII码" class="headerlink" title="ASCII码"></a><strong>ASCII码</strong></h4><p>在计算机内部，所有的信息最终都是一个二进制值。</p><p>一个二进制数就是一位（bit），有0和1两种状态。一个字节（byte）是8个二进制数组成的，所以1 byte = 8 bit。</p><p>也就是说一个字节一共可以用来表示256种不同的状态，从00000000到11111111。如果每一个状态都代表一个符号的话，那么一个字节可以用来表示256个符号。</p><p>上个世界60年代，美国制定了一套算是最早的字符编码，制定了一套基于英文字符与二进制位之间的对应关系。这套标准被称为ASCII码，一直使用到今天。</p><p>ASCII码一共规定了128个字符的编码。比如：</p><p>字符 A = 65（十进制数）= 0100 0001（二进制数）</p><p>字符 1 = 49（十进制数）= 0011 0001（二进制数）等等</p><p>下图为ASCII码的对照表</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123917.png" alt="img"></p><p>这128个字符的编码规则，只占用了一个字节的后面7位，最前面的一位统一规定为0。</p><p>英文国家使用128个字符编码就足够了，但是如果用来表示其它国家的语言，128个符号是远远不够的，于是乎就出现了非ASCII码们。</p><h4 id="非ASCII码"><a href="#非ASCII码" class="headerlink" title="非ASCII码"></a><strong>非ASCII码</strong></h4><p>非ASCII码基本都是基于ASCII码进行的扩充，他们都保留了ASCII码0~127这段编码的规范。也就是说非ASCII码的前面部分往往是和ASCII码的规则是相同的。</p><p>对于一些欧洲国家，他们使用一个字节便可以表示完自己所有的文字，他们利用了字节中闲置的最高位编入新的符号，因为我们知道ASCII码的编码规则是：一个字节中的8位，只占用了一个字节的后面7位，最前面的一位统一规定为0。所以这些语言系统中文字较少的国家让最前面的一位可以为1，他们就可以为自己的文字在128~255这一段加入新的对应规则。</p><p>比如：130这个数值在法语编码中代表了<code>é</code>，在希伯来语编码中却代表了字母<code>Gimel</code> (<code>ג</code>)</p><p>这种一个字节就把字符表示完的做法只适用于语言系统中文字较少的国家，因为他们的语言的字母是有限的。</p><p>对于使用象形文字的国家来说，一个字节完全不够用！比如中国，我们的汉字多达10万左右，一个字节最多也只能表示256种符号，是远远不够的。所以必须使用多个字节来表示一个符号。比如我们前面提到的中国的简体中文GB2312编码，是使用两个字节表示一个汉字，所以理论上来说可以表示256x256=65536个符号。</p><p>所以所谓的非ASCII码，就是指的除了ASCII码以外的编码格式，每个国家都至少有1种针对自己语言文字的编码格式，每一个编码格式中 数值和字符的对应关系都可能不相同。这也就造成了前面说到的乱码问题。在全世界范围内进行网络通信时，如果每个国家都使用不统一的编码格式，那么出现乱码的情况将随处可见。</p><p>因此随着互联网的发展，人们决定要制定一套全世界统一的的编码规则，将世界上所有的符号都纳入其中，为每一个符号赋予独一无二的编码（2进制数值）。那么这样就不会出现乱码问题，影响信息的传递了。</p><h4 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a><strong>Unicode</strong></h4><p>Unicode可以理解为是 Unique Code 的简写，翻译过来是“唯一的编码”。</p><p>它出现的主要原因就是用来解决乱码问题的，它将世界上所有的符号都纳入其中，每一个符号都为其分配一个独一无二的二进制数表示它，那么乱码问题就会消失。</p><p>Unicode是一个很大的集合，现在的规模可以容纳100多万个符号，每个符号对应的二进制数都不一样。这样就确保了不同语言的字符不会再有冲突。</p><p>那么这样可能就存在一个问题，就是有的符号用1个字节8位就可以表示了，有的符号可能需要使用2个字节16位甚至3个字节24位才能表示。就比如说ASCII码，它的存储规则就是一个字节存储一个字符，那么当我们使用Unicode编码时，到底用几个字节来存储字符呢？</p><p>因此我们需要注意：<strong>Unicode编码只是一个符号集，它只规定符号和二进制的对应关系，并没有规定这个二进制数值应该如何存储。</strong></p><p><strong>而UTF-8、UTF-16、UTF-32三种编码格式才是基于Unicode实现的具体编码方案</strong></p><p>UTF-8编码：可变字节编码方案，可以根据实际情况使用1个、2个、3个、4个字节来存储字符</p><p>UTF-16编码：可变字节编码方案，可以根据实际情况使用2个、4个字节来存储字符</p><p>UTF-32编码：固定字节编码方案，用4个字节来存储字符</p><h4 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a><strong>UTF-8</strong></h4><p>UTF-8是Unicode的实现方式之一，它的最大特点是：它是一种变长的编码方式，可以使用1~4个字节表示一个字符，根据不同的符号而变化字节的长度。</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123273.png" alt="img"></p><p><strong>Unicode是世界上所有符号对应二进制数据的关系集合</strong></p><p><strong>UTF-8是Unicode的实现方式之一：UTF-8 = Unicode符号集 + 变长的编码规则</strong></p><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region 非字符串类型转字节数组</span></span><br><span class="line"><span class="comment">//关键类：BitConverter</span></span><br><span class="line"><span class="comment">//所在命名空间：System</span></span><br><span class="line"><span class="comment">//主要作用：除字符串的其它常用类型和字节数组相互转换</span></span><br><span class="line"></span><br><span class="line">byte[] bytes = BitConverter.<span class="built_in">GetBytes</span>(<span class="number">1</span>);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 字符串类型转字节数组</span></span><br><span class="line"><span class="comment">//关键类：Encoding</span></span><br><span class="line"><span class="comment">//所在命名空间：System.Text</span></span><br><span class="line"><span class="comment">//主要作用：将字符串类型和字节数组相互转换，并且决定转换时使用的字符编码类型，网络通信时建议大家使用UTF-8类型</span></span><br><span class="line">byte[] byte2 = Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;的卡萨福利卡决胜巅峰卡视角的副驾驶的&quot;</span>);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 如何将一个类对象转换为二进制</span></span><br><span class="line"><span class="comment">//注意：网络通信中我们不能直接使用数据持久化2进制知识点中的</span></span><br><span class="line"><span class="comment">//BinaryFormatter 2进制格式化类</span></span><br><span class="line"><span class="comment">//因为客户端和服务器使用的语言可能不一样，BinaryFormatter是C#的序列化规则，和其它语言之间的兼容性不好</span></span><br><span class="line"><span class="comment">//如果使用它，那么其它语言开发的服务器无法对其进行反序列化</span></span><br><span class="line"><span class="comment">//我们需要自己来处理将类对象数据序列化为字节数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//单纯的转换一个变量为字节数组非常的简单</span></span><br><span class="line"><span class="comment">//但是我们如何将一个类对象携带的所有信息放入到一个字节数组中呢</span></span><br><span class="line"><span class="comment">//我们需要做以下几步</span></span><br><span class="line"><span class="comment">//1.明确字节数组的容量（注意：在确定字符串字节长度时要考虑解析时如何处理）</span></span><br><span class="line">PlayerInfo info = <span class="keyword">new</span> <span class="built_in">PlayerInfo</span>();</span><br><span class="line">info.lev = <span class="number">10</span>;</span><br><span class="line">info.name = <span class="string">&quot;刘英博&quot;</span>;</span><br><span class="line">info.atk = <span class="number">88</span>;</span><br><span class="line">info.sex = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//得到的 这个Info数据 如果转换成 字节数组 那么字节数组容器需要的容量</span></span><br><span class="line"><span class="type">int</span> indexNum = <span class="built_in">sizeof</span>(<span class="type">int</span>) + <span class="comment">//lev int类型  4</span></span><br><span class="line">               <span class="built_in">sizeof</span>(<span class="type">int</span>) + <span class="comment">//代表 name字符串转换成字节数组后 数组的长度 4</span></span><br><span class="line">               Encoding.UTF8.<span class="built_in">GetBytes</span>(info.name).Length + <span class="comment">//字符串具体字节数组的长度</span></span><br><span class="line">               <span class="built_in">sizeof</span>(<span class="type">short</span>) + <span class="comment">//atk short类型 2</span></span><br><span class="line">               <span class="built_in">sizeof</span>(<span class="type">bool</span>); <span class="comment">//sex bool类型 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.申明一个装载信息的字节数组容器</span></span><br><span class="line">byte[] playerBytes = <span class="keyword">new</span> byte[indexNum];</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.将对象中的所有信息转为字节数组并放入该容器当中（可以利用数组中的CopeTo方法转存字节数组）</span></span><br><span class="line"><span class="comment">//CopyTo方法的第二个参数代表 从容器的第几个位置开始存储</span></span><br><span class="line"><span class="type">int</span> index = <span class="number">0</span>;<span class="comment">//从 playerBytes数组中的第几个位置去存储数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//等级</span></span><br><span class="line">BitConverter.<span class="built_in">GetBytes</span>(info.lev).<span class="built_in">CopyTo</span>(playerBytes, index);</span><br><span class="line">index += <span class="built_in">sizeof</span>(<span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//姓名</span></span><br><span class="line">byte[] strBytes = Encoding.UTF8.<span class="built_in">GetBytes</span>(info.name);</span><br><span class="line"><span class="type">int</span> num = strBytes.Length;</span><br><span class="line"><span class="comment">//存储的是姓名转换成字节数组后 字节数组的长度</span></span><br><span class="line">BitConverter.<span class="built_in">GetBytes</span>(num).<span class="built_in">CopyTo</span>(playerBytes, index);</span><br><span class="line">index += <span class="built_in">sizeof</span>(<span class="type">int</span>);</span><br><span class="line"><span class="comment">//存储字符串的字节数组</span></span><br><span class="line">strBytes.<span class="built_in">CopyTo</span>(playerBytes, index);</span><br><span class="line">index += num;</span><br><span class="line"></span><br><span class="line"><span class="comment">//攻击力</span></span><br><span class="line">BitConverter.<span class="built_in">GetBytes</span>(info.atk).<span class="built_in">CopyTo</span>(playerBytes, index);</span><br><span class="line">index += <span class="built_in">sizeof</span>(<span class="type">short</span>);</span><br><span class="line"><span class="comment">//性别</span></span><br><span class="line">BitConverter.<span class="built_in">GetBytes</span>(info.sex).<span class="built_in">CopyTo</span>(playerBytes, index);</span><br><span class="line">index += <span class="built_in">sizeof</span>(<span class="type">bool</span>);</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><p>BitConverter转换非字符串的类型的变量为字节数组</p><p>Encoding.UTF8转换字符串类型的变量为字节数组（注意：为了考虑反序列化，我们在转存2进制，序列化字符串之前，先序列化字符串字节数组的长度）</p><h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region 字节数组转非字符串类型</span></span><br><span class="line"><span class="comment">//关键类：BitConverter</span></span><br><span class="line"><span class="comment">//所在命名空间：System</span></span><br><span class="line"><span class="comment">//主要作用：除字符串的其它常用类型和字节数组相互转换</span></span><br><span class="line">byte[] bytes = BitConverter.<span class="built_in">GetBytes</span>(<span class="number">99</span>);</span><br><span class="line"><span class="type">int</span> i = BitConverter.<span class="built_in">ToInt32</span>(bytes, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">print</span>(i);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 字节数组转字符串类型</span></span><br><span class="line"><span class="comment">//关键类：Encoding</span></span><br><span class="line"><span class="comment">//所在命名空间：System.Text</span></span><br><span class="line"><span class="comment">//主要作用：将字符串类型和字节数组相互转换，并且决定转换时使用的字符编码类型，网络通信时建议大家使用UTF-8类型</span></span><br><span class="line">byte[] bytes2 = Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;123123空间大撒了房间阿斯利康放大镜&quot;</span>);</span><br><span class="line">string str = Encoding.UTF8.<span class="built_in">GetString</span>(bytes2, <span class="number">0</span>, bytes2.Length);</span><br><span class="line"><span class="built_in">print</span>(str);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 如何将二进制数据转为一个类对象</span></span><br><span class="line"><span class="comment">//1.获取到对应的字节数组</span></span><br><span class="line">PlayerInfo info = <span class="keyword">new</span> <span class="built_in">PlayerInfo</span>();</span><br><span class="line">info.lev = <span class="number">10</span>;</span><br><span class="line">info.name = <span class="string">&quot;刘英博&quot;</span>;</span><br><span class="line">info.atk = <span class="number">88</span>;</span><br><span class="line">info.sex = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">byte[] playerBytes = info.<span class="built_in">GetBytes</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.将字节数组按照序列化时的顺序进行反序列化(将对应字节分组转换为对应类型变量)</span></span><br><span class="line">PlayerInfo info2 = <span class="keyword">new</span> <span class="built_in">PlayerInfo</span>();</span><br><span class="line"><span class="comment">//等级</span></span><br><span class="line"><span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">info2.lev = BitConverter.<span class="built_in">ToInt32</span>(playerBytes, index);</span><br><span class="line">index += <span class="number">4</span>;</span><br><span class="line"><span class="built_in">print</span>(info2.lev);</span><br><span class="line"><span class="comment">//姓名的长度</span></span><br><span class="line"><span class="type">int</span> length = BitConverter.<span class="built_in">ToInt32</span>(playerBytes, index);</span><br><span class="line">index += <span class="number">4</span>;</span><br><span class="line"><span class="comment">//姓名字符串</span></span><br><span class="line">info2.name = Encoding.UTF8.<span class="built_in">GetString</span>(playerBytes, index, length);</span><br><span class="line">index += length;</span><br><span class="line"><span class="built_in">print</span>(info2.name);</span><br><span class="line"><span class="comment">//攻击力</span></span><br><span class="line">info2.atk = BitConverter.<span class="built_in">ToInt16</span>(playerBytes, index);</span><br><span class="line">index += <span class="number">2</span>;</span><br><span class="line"><span class="built_in">print</span>(info2.atk);</span><br><span class="line"><span class="comment">//性别</span></span><br><span class="line">info2.sex = BitConverter.<span class="built_in">ToBoolean</span>(playerBytes, index);</span><br><span class="line">index += <span class="number">1</span>;</span><br><span class="line"><span class="built_in">print</span>(info2.sex);</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><p>BitConverter转换字节数组为非字符串的类型的变量</p><p>Encoding.UTF8转换字节数组为字符串类型的变量（注意：先读长度，再读字符串）</p><h2 id="套接字Socket"><a href="#套接字Socket" class="headerlink" title="套接字Socket"></a>套接字Socket</h2><h3 id="Socket概述"><a href="#Socket概述" class="headerlink" title="Socket概述"></a>Socket概述</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region Socket套接字的作用</span></span><br><span class="line"><span class="comment">//它是C#提供给我们用于网络通信的一个类（在其它语言当中也有对应的Socket类）</span></span><br><span class="line"><span class="comment">//类名：Socket</span></span><br><span class="line"><span class="comment">//命名空间：System.Net.Sockets</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Socket套接字是支持TCP/IP网络通信的基本操作单位</span></span><br><span class="line"><span class="comment">//一个套接字对象包含以下关键信息</span></span><br><span class="line"><span class="comment">//1.本机的IP地址和端口</span></span><br><span class="line"><span class="comment">//2.对方主机的IP地址和端口</span></span><br><span class="line"><span class="comment">//3.双方通信的协议信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一个Sccket对象表示一个本地或者远程套接字信息</span></span><br><span class="line"><span class="comment">//它可以被视为一个数据通道</span></span><br><span class="line"><span class="comment">//这个通道连接与客户端和服务端之间</span></span><br><span class="line"><span class="comment">//数据的发送和接受均通过这个通道进行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一般在制作长连接游戏时，我们会使用Socket套接字作为我们的通信方案</span></span><br><span class="line"><span class="comment">//我们通过它连接客户端和服务端，通过它来收发消息</span></span><br><span class="line"><span class="comment">//你可以把它抽象的想象成一根管子，插在客户端和服务端应用程序上，通过这个管子来传递交换信息</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region Socket的类型</span></span><br><span class="line"><span class="comment">//Socket套接字有3种不同的类型</span></span><br><span class="line"><span class="comment">//1.流套接字</span></span><br><span class="line"><span class="comment">//  主要用于实现TCP通信，提供了面向连接、可靠的、有序的、数据无差错且无重复的数据传输服务</span></span><br><span class="line"><span class="comment">//2.数据报套接字</span></span><br><span class="line"><span class="comment">//  主要用于实现UDP通信，提供了无连接的通信服务，数据包的长度不能大于32KB，不提供正确性检查，不保证顺序，可能出现重发、丢失等情况</span></span><br><span class="line"><span class="comment">//3.原始套接字（不常用，不深入讲解）</span></span><br><span class="line"><span class="comment">//  主要用于实现IP数据包通信，用于直接访问协议的较低层，常用于侦听和分析数据包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过Socket的构造函数 我们可以申明不同类型的套接字</span></span><br><span class="line"><span class="comment">//Socket s = new Socket()</span></span><br><span class="line"><span class="comment">//参数一：AddressFamily 网络寻址 枚举类型，决定寻址方案</span></span><br><span class="line"><span class="comment">//  常用：</span></span><br><span class="line"><span class="comment">//  1.InterNetwork  IPv4寻址</span></span><br><span class="line"><span class="comment">//  2.InterNetwork6 IPv6寻址</span></span><br><span class="line"><span class="comment">//  做了解：</span></span><br><span class="line"><span class="comment">//  1.UNIX          UNIX本地到主机地址 </span></span><br><span class="line"><span class="comment">//  2.ImpLink       ARPANETIMP地址</span></span><br><span class="line"><span class="comment">//  3.Ipx           IPX或SPX地址</span></span><br><span class="line"><span class="comment">//  4.Iso           ISO协议的地址</span></span><br><span class="line"><span class="comment">//  5.Osi           OSI协议的地址</span></span><br><span class="line"><span class="comment">//  7.NetBios       NetBios地址</span></span><br><span class="line"><span class="comment">//  9.Atm           本机ATM服务地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数二：SocketType 套接字枚举类型，决定使用的套接字类型</span></span><br><span class="line"><span class="comment">//  常用：</span></span><br><span class="line"><span class="comment">//  1.Dgram         支持数据报，最大长度固定的无连接、不可靠的消息(主要用于UDP通信)</span></span><br><span class="line"><span class="comment">//  2.Stream        支持可靠、双向、基于连接的字节流（主要用于TCP通信）</span></span><br><span class="line"><span class="comment">//  做了解：</span></span><br><span class="line"><span class="comment">//  1.Raw           支持对基础传输协议的访问</span></span><br><span class="line"><span class="comment">//  2.Rdm           支持无连接、面向消息、以可靠方式发送的消息</span></span><br><span class="line"><span class="comment">//  3.Seqpacket     提供排序字节流的面向连接且可靠的双向传输</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数三：ProtocolType 协议类型枚举类型，决定套接字使用的通信协议</span></span><br><span class="line"><span class="comment">//  常用：</span></span><br><span class="line"><span class="comment">//  1.TCP           TCP传输控制协议</span></span><br><span class="line"><span class="comment">//  2.UDP           UDP用户数据报协议</span></span><br><span class="line"><span class="comment">//  做了解：</span></span><br><span class="line"><span class="comment">//  1.IP            IP网际协议</span></span><br><span class="line"><span class="comment">//  2.Icmp          Icmp网际消息控制协议</span></span><br><span class="line"><span class="comment">//  3.Igmp          Igmp网际组管理协议</span></span><br><span class="line"><span class="comment">//  4.Ggp           网关到网关协议</span></span><br><span class="line"><span class="comment">//  5.IPv4          Internet协议版本4</span></span><br><span class="line"><span class="comment">//  6.Pup           PARC通用数据包协议</span></span><br><span class="line"><span class="comment">//  7.Idp           Internet数据报协议</span></span><br><span class="line"><span class="comment">//  8.Raw           原始IP数据包协议</span></span><br><span class="line"><span class="comment">//  9.Ipx           Internet数据包交换协议</span></span><br><span class="line"><span class="comment">//  10.Spx          顺序包交换协议</span></span><br><span class="line"><span class="comment">//  11.IcmpV6       用于IPv6的Internet控制消息协议</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2、3参数的常用搭配：</span></span><br><span class="line"><span class="comment">//       SocketType.Dgram  +  ProtocolType.Udp  = UDP协议通信（常用，主要学习）</span></span><br><span class="line"><span class="comment">//       SocketType.Stream  +  ProtocolType.Tcp  = TCP协议通信（常用，主要学习）</span></span><br><span class="line"><span class="comment">//       SocketType.Raw  +  ProtocolType.Icmp  = Internet控制报文协议（了解）</span></span><br><span class="line"><span class="comment">//       SocketType.Raw  +  ProtocolType.Raw  = 简单的IP包通信（了解）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//我们必须掌握的</span></span><br><span class="line"><span class="comment">//TCP流套接字</span></span><br><span class="line">Socket socketTcp = <span class="keyword">new</span> <span class="built_in">Socket</span>(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//UDP数据报套接字</span></span><br><span class="line">Socket socketUdp = <span class="keyword">new</span> <span class="built_in">Socket</span>(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region Socket的常用属性</span></span><br><span class="line"><span class="comment">//1.套接字的连接状态</span></span><br><span class="line"><span class="keyword">if</span>(socketTcp.Connected)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.获取套接字的类型</span></span><br><span class="line"><span class="built_in">print</span>(socketTcp.SocketType);</span><br><span class="line"><span class="comment">//3.获取套接字的协议类型</span></span><br><span class="line"><span class="built_in">print</span>(socketTcp.ProtocolType);</span><br><span class="line"><span class="comment">//4.获取套接字的寻址方案</span></span><br><span class="line"><span class="built_in">print</span>(socketTcp.AddressFamily);</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.从网络中获取准备读取的数据数据量</span></span><br><span class="line"><span class="built_in">print</span>(socketTcp.Available);</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.获取本机EndPoint对象(注意 ：IPEndPoint继承EndPoint)</span></span><br><span class="line"><span class="comment">//socketTcp.LocalEndPoint as IPEndPoint</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//7.获取远程EndPoint对象</span></span><br><span class="line"><span class="comment">//socketTcp.RemoteEndPoint as IPEndPoint</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region Socket的常用方法</span></span><br><span class="line"><span class="comment">//1.主要用于服务端</span></span><br><span class="line"><span class="comment">//  1-1:绑定IP和端口</span></span><br><span class="line">IPEndPoint ipPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">8080</span>);</span><br><span class="line">socketTcp.<span class="built_in">Bind</span>(ipPoint);</span><br><span class="line"><span class="comment">//  1-2:设置客户端连接的最大数量</span></span><br><span class="line">socketTcp.<span class="built_in">Listen</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//  1-3:等待客户端连入</span></span><br><span class="line">socketTcp.<span class="built_in">Accept</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.主要用于客户端</span></span><br><span class="line"><span class="comment">//  1-1:连接远程服务端</span></span><br><span class="line">socketTcp.<span class="built_in">Connect</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;118.12.123.11&quot;</span>), <span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.客户端服务端都会用的</span></span><br><span class="line"><span class="comment">//  1-1:同步发送和接收数据</span></span><br><span class="line"><span class="comment">//  1-2:异步发送和接收数据</span></span><br><span class="line"><span class="comment">//  1-3:释放连接并关闭Socket，先与Close调用</span></span><br><span class="line">socketTcp.<span class="built_in">Shutdown</span>(SocketShutdown.Both);</span><br><span class="line"><span class="comment">//  1-4:关闭连接，释放所有Socket关联资源</span></span><br><span class="line">socketTcp.<span class="built_in">Close</span>();</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h3 id="TCP通信"><a href="#TCP通信" class="headerlink" title="TCP通信"></a>TCP通信</h3><h4 id="服务端和客户端需要做什么"><a href="#服务端和客户端需要做什么" class="headerlink" title="服务端和客户端需要做什么"></a>服务端和客户端需要做什么</h4><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123242.png" alt="image-20220521151533548"></p><h4 id="TCP协议三次握手的体现"><a href="#TCP协议三次握手的体现" class="headerlink" title="TCP协议三次握手的体现"></a>TCP协议三次握手的体现</h4><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123581.png" alt="image-20220521151638515"></p><h4 id="TCP协议四次挥手的体现"><a href="#TCP协议四次挥手的体现" class="headerlink" title="TCP协议四次挥手的体现"></a>TCP协议四次挥手的体现</h4><p><img src="/Users/liuyingbo/Library/Application Support/typora-user-images/image-20220521151714969.png" alt="image-20220521151714969"></p><h4 id="TCP基本API"><a href="#TCP基本API" class="headerlink" title="TCP基本API"></a>TCP基本API</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region 实现服务端基本逻辑</span></span><br><span class="line"><span class="comment">//1.创建套接字Socket（TCP）</span></span><br><span class="line">Socket socketTcp = <span class="keyword">new</span> <span class="built_in">Socket</span>(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line"><span class="comment">//2.用Bind方法将套接字与本地地址绑定</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    IPEndPoint ipPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">8080</span>);</span><br><span class="line">    socketTcp.<span class="built_in">Bind</span>(ipPoint);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (Exception e)</span><br><span class="line">&#123;</span><br><span class="line">    Console.<span class="built_in">WriteLine</span>(<span class="string">&quot;绑定报错&quot;</span> + e.Message);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.用Listen方法监听</span></span><br><span class="line">socketTcp.<span class="built_in">Listen</span>(<span class="number">1024</span>);</span><br><span class="line">Console.<span class="built_in">WriteLine</span>(<span class="string">&quot;服务端绑定监听结束，等待客户端连入&quot;</span>);</span><br><span class="line"><span class="comment">//4.用Accept方法等待客户端连接</span></span><br><span class="line"><span class="comment">//5.建立连接，Accept返回新套接字</span></span><br><span class="line">Socket socketClient = socketTcp.<span class="built_in">Accept</span>();</span><br><span class="line">Console.<span class="built_in">WriteLine</span>(<span class="string">&quot;有客户端连入了&quot;</span>);</span><br><span class="line"><span class="comment">//6.用Send和Receive相关方法收发数据</span></span><br><span class="line"><span class="comment">//发送</span></span><br><span class="line">socketClient.<span class="built_in">Send</span>(Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;欢迎连入服务端&quot;</span>));</span><br><span class="line"><span class="comment">//接受</span></span><br><span class="line">byte[] result = <span class="keyword">new</span> byte[<span class="number">1024</span>];</span><br><span class="line"><span class="comment">//返回值为接受到的字节数</span></span><br><span class="line"><span class="type">int</span> receiveNum = socketClient.<span class="built_in">Receive</span>(result);</span><br><span class="line">Console.<span class="built_in">WriteLine</span>(<span class="string">&quot;接受到了&#123;0&#125;发来的消息：&#123;1&#125;&quot;</span>,</span><br><span class="line">    socketClient.RemoteEndPoint.<span class="built_in">ToString</span>(),</span><br><span class="line">    Encoding.UTF8.<span class="built_in">GetString</span>(result, <span class="number">0</span>, receiveNum));</span><br><span class="line"></span><br><span class="line"><span class="comment">//7.用Shutdown方法释放连接</span></span><br><span class="line">socketClient.<span class="built_in">Shutdown</span>(SocketShutdown.Both);</span><br><span class="line"><span class="comment">//8.关闭套接字</span></span><br><span class="line">socketClient.<span class="built_in">Close</span>();</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 实现客户端基本逻辑</span></span><br><span class="line"><span class="comment">//1.创建套接字Socket</span></span><br><span class="line">Socket socket = <span class="keyword">new</span> <span class="built_in">Socket</span>(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line"><span class="comment">//2.用Connect方法与服务端相连</span></span><br><span class="line"><span class="comment">//确定服务端的IP和端口</span></span><br><span class="line">IPEndPoint ipPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">8080</span>);</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    socket.<span class="built_in">Connect</span>(ipPoint);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (SocketException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.ErrorCode == <span class="number">10061</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;服务器拒绝连接&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;连接服务器失败&quot;</span> + e.ErrorCode);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.用Send和Receive相关方法收发数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//接收数据</span></span><br><span class="line">byte[] receiveBytes = <span class="keyword">new</span> byte[<span class="number">1024</span>];</span><br><span class="line"><span class="type">int</span> receiveNum = socket.<span class="built_in">Receive</span>(receiveBytes);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;收到服务端发来的消息：&quot;</span> + Encoding.UTF8.<span class="built_in">GetString</span>(receiveBytes, <span class="number">0</span>, receiveNum));</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送数据</span></span><br><span class="line">socket.<span class="built_in">Send</span>(Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;你好，我是客户端&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.用Shutdown方法释放连接</span></span><br><span class="line">socket.<span class="built_in">Shutdown</span>(SocketShutdown.Both);</span><br><span class="line"><span class="comment">//5.关闭套接字</span></span><br><span class="line">socket.<span class="built_in">Close</span>();</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h4 id="如何区分消息"><a href="#如何区分消息" class="headerlink" title="如何区分消息"></a>如何区分消息</h4><p>为发送的信息添加标识，比如添加消息ID</p><p>在所有发送的消息的头部加上消息ID(int、short、byte、long都可以，根据实际情况选择)</p><p>举例说明：</p><p>如果选用int类型作为消息ID的类型</p><p>前4个字节为消息ID</p><p>后面的字节为数据类的内容</p><p>####<strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></p><p>这样每次收到消息时，先把前4个字节取出来解析为消息ID</p><p>再根据ID进行消息反序列化即可</p><h4 id="分包、黏包"><a href="#分包、黏包" class="headerlink" title="分包、黏包"></a>分包、黏包</h4><h5 id="什么是分包、黏包？"><a href="#什么是分包、黏包？" class="headerlink" title="什么是分包、黏包？"></a>什么是分包、黏包？</h5><p>分包、黏包指在网络通信中由于各种因素（网络环境、API规则等）造成的消息与消息之间出现的两种状态</p><p>分包：一个消息分成了多个消息进行发送</p><p>黏包：一个消息和另一个消息黏在了一起</p><p>注意：分包和黏包可能同时发生</p><h5 id="如何解决？"><a href="#如何解决？" class="headerlink" title="如何解决？"></a>如何解决？</h5><p>为消息添加头部，头部记录消息的长度</p><p>当我们接收到消息时，通过消息长度来判断是否分包、黏包</p><p>对消息进行拆分处理、合并处理</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123236.png" alt="分包黏包解决方案图"></p><h4 id="心跳消息"><a href="#心跳消息" class="headerlink" title="心跳消息"></a>心跳消息</h4><p>客户端主动断开连接会调用socket的 ShutDown和Close方法，但是通过调用这两个方法后 服务器端无法得知客户端已经主动断开</p><p>客户端尝试使用Disconnect方法主动断开连接，Socket当中有一个专门在客户端使用的方法，客户端调用该方法和服务器端断开连接</p><p>服务器端可以通过Conected属性判断连接状态决定是否释放Socket</p><p>但是由于服务器端Conected变量表示的是上一次收发消息是否成功，所以服务器端无法准确判断客户端的连接状态，因此 我们需要自定义一条退出消息 用于准确断开和客户端之间的连接</p><h5 id="什么是心跳消息？"><a href="#什么是心跳消息？" class="headerlink" title="什么是心跳消息？"></a>什么是心跳消息？</h5><p>所谓心跳消息，就是在长连接中，客户端和服务端之间定期发送的一种特殊的数据包，用于通知对方自己还在线，以确保长连接的有效性</p><p>由于其发送的时间间隔往往是固定的持续的，就像是心跳一样一直存在，所以我们称之为心跳消息</p><h5 id="为什么需要心跳消息？"><a href="#为什么需要心跳消息？" class="headerlink" title="为什么需要心跳消息？"></a>为什么需要心跳消息？</h5><p>1.避免非正常关闭客户端时，服务器无法正常收到关闭连接消息，通过心跳消息我们可以自定义超时判断，如果超时没有收到客户端消息，证明客户端已经断开连接</p><p>2.避免客户端长期不发送消息，防火墙或者路由器会断开连接，我们可以通过心跳消息一直保持活跃状态</p><h5 id="实现心跳消息"><a href="#实现心跳消息" class="headerlink" title="实现心跳消息"></a>实现心跳消息</h5><p>客户端：定时发送消息</p><p>服务器：不停检测上次收到某客户端消息的时间，如果超时则认为连接已经断开</p><p>心跳消息是长连接项目中必备的一套逻辑规则，通过它可以帮助我们在服务器端及时的释放掉失效的socket，可以有效避免当客户端非正常关闭时，服务器端不能及时判断连接已断开</p><h3 id="UDP通信"><a href="#UDP通信" class="headerlink" title="UDP通信"></a>UDP通信</h3><h4 id="服务端和客户端需要做什么-1"><a href="#服务端和客户端需要做什么-1" class="headerlink" title="服务端和客户端需要做什么"></a>服务端和客户端需要做什么</h4><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123022.png" alt="image-20220521160007101"></p><h4 id="UDP相对TCP的区别"><a href="#UDP相对TCP的区别" class="headerlink" title="UDP相对TCP的区别"></a>UDP相对TCP的区别</h4><p><img src="/Users/liuyingbo/Library/Application Support/typora-user-images/image-20220521160026008.png" alt="image-20220521160026008"></p><h4 id="UDP的分包、黏包问题"><a href="#UDP的分包、黏包问题" class="headerlink" title="UDP的分包、黏包问题"></a>UDP的分包、黏包问题</h4><h5 id="分包"><a href="#分包" class="headerlink" title="分包"></a>分包</h5><p>UDP本身作为无连接的不可靠的传输协议（适合频繁发送较小的数据包），不会对数据包进行合并发送，一端发送什么数据，直接就发出去了，他不会对数据合并，因此在UDP当中不会出现黏包问题（除非你手动进行黏包）</p><h5 id="分包问题"><a href="#分包问题" class="headerlink" title="分包问题"></a>分包问题</h5><p>由于UDP是不可靠的连接，消息传递过程中可能出现无序、丢包等情况，所以如果允许UDP进行分包，那后果将会是灾难性的，比如分包的后半段丢包或者比上半段先发来，我们在处理消息时将会非常困难，因此为了避免其分包，我们建议在发送UDP消息时控制消息的大小在MTU（最大传输单元）范围内</p><p>MTU（Maximum Transmission Unit）最大传输单元，用来通知对方所能接受数据服务单元的最大尺寸</p><p>不同操作系统会提供用户一个默认值</p><p>以太网和802.3对数据帧的长度限制，其最大值分别是1500字节和1492字节</p><p>由于UDP包本身带有一些信息，因此建议：</p><p>1.局域网环境下：1472字节以内（1500减去UDP头部28为1472）</p><p>2.互联网环境下：548字节以内（老的ISP拨号网络的标准值为576减去UDP头部28为548）</p><p>只要遵守这个规则，就不会出现自动分包的情况</p><p>如果想要发送的消息确实比较大，要大于548字节或1472字节这个限制呢？比如我们要发一个5000字节的数据，他是一条完整消息，我们可以进行手动分包，将5000拆分成多个消息，每个消息不超过限制，但是手动分包的前提是要解决UDP的丢包和无序问题，我们可以将不可靠的UDP通信实现为可靠的UDP通信</p><p>比如：在消息中加入序号、消息总包数、自己的包ID、长度等等信息，并且实现消息确认、消息重发等功能</p><h4 id="UDP基本API"><a href="#UDP基本API" class="headerlink" title="UDP基本API"></a>UDP基本API</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region 实现UDP服务端通信 收发字符串</span></span><br><span class="line"><span class="comment">//1.创建套接字</span></span><br><span class="line">Socket socket = <span class="keyword">new</span> <span class="built_in">Socket</span>(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);</span><br><span class="line"><span class="comment">//2.绑定本机地址</span></span><br><span class="line">IPEndPoint ipPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">8081</span>);</span><br><span class="line">socket.<span class="built_in">Bind</span>(ipPoint);</span><br><span class="line">Console.<span class="built_in">WriteLine</span>(<span class="string">&quot;服务器开启&quot;</span>);</span><br><span class="line"><span class="comment">//3.接受消息</span></span><br><span class="line">byte[] bytes = <span class="keyword">new</span> byte[<span class="number">512</span>];</span><br><span class="line"><span class="comment">//这个变量主要是用来记录 谁发的信息给你 传入函数后 在内部 它会帮助我们进行赋值</span></span><br><span class="line">EndPoint remoteIpPoint2 = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.Any, <span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> length = socket.<span class="built_in">ReceiveFrom</span>(bytes, ref remoteIpPoint2);</span><br><span class="line">Console.<span class="built_in">WriteLine</span>(<span class="string">&quot;IP:&quot;</span> + (remoteIpPoint2 as IPEndPoint).Address.<span class="built_in">ToString</span>() +</span><br><span class="line">    <span class="string">&quot;port:&quot;</span> + (remoteIpPoint2 as IPEndPoint).Port +</span><br><span class="line">    <span class="string">&quot;发来了&quot;</span> +</span><br><span class="line">    Encoding.UTF8.<span class="built_in">GetString</span>(bytes, <span class="number">0</span>, length));</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.发送到指定目标</span></span><br><span class="line"><span class="comment">//由于我们先收 所以 我们已经知道谁发了消息给我 我直接发给它就行了</span></span><br><span class="line">socket.<span class="built_in">SendTo</span>(Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;欢迎发送消息给服务器&quot;</span>), remoteIpPoint2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.释放关闭</span></span><br><span class="line">socket.<span class="built_in">Shutdown</span>(SocketShutdown.Both);</span><br><span class="line">socket.<span class="built_in">Close</span>();</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 实现UDP客户端通信 收发字符串</span></span><br><span class="line"><span class="comment">//1.创建套接字</span></span><br><span class="line">Socket socket = <span class="keyword">new</span> <span class="built_in">Socket</span>(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.绑定本机地址</span></span><br><span class="line">IPEndPoint ipPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">8080</span>);</span><br><span class="line">socket.<span class="built_in">Bind</span>(ipPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.发送到指定目标</span></span><br><span class="line">IPEndPoint remoteIpPoint = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.<span class="built_in">Parse</span>(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">8081</span>);</span><br><span class="line"><span class="comment">//指定要发送的字节数 和 远程计算机的 IP和端口</span></span><br><span class="line">socket.<span class="built_in">SendTo</span>(Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;我来了&quot;</span>), remoteIpPoint);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.接受消息</span></span><br><span class="line">byte[] bytes = <span class="keyword">new</span> byte[<span class="number">512</span>];</span><br><span class="line"><span class="comment">//这个变量主要是用来记录 谁发的信息给你 传入函数后 在内部 它会帮助我们进行赋值</span></span><br><span class="line">EndPoint remoteIpPoint2 = <span class="keyword">new</span> <span class="built_in">IPEndPoint</span>(IPAddress.Any, <span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> length = socket.<span class="built_in">ReceiveFrom</span>(bytes, ref remoteIpPoint2);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;IP:&quot;</span> + (remoteIpPoint2 as IPEndPoint).Address.<span class="built_in">ToString</span>() +</span><br><span class="line">    <span class="string">&quot;port:&quot;</span> + (remoteIpPoint2 as IPEndPoint).Port +</span><br><span class="line">    <span class="string">&quot;发来了&quot;</span> +</span><br><span class="line">    Encoding.UTF8.<span class="built_in">GetString</span>(bytes, <span class="number">0</span>, length));</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.释放关闭</span></span><br><span class="line">socket.<span class="built_in">Shutdown</span>(SocketShutdown.Both);</span><br><span class="line">socket.<span class="built_in">Close</span>();</span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h2 id="文件传输FTP"><a href="#文件传输FTP" class="headerlink" title="文件传输FTP"></a>文件传输FTP</h2><h3 id="FTP工作原理"><a href="#FTP工作原理" class="headerlink" title="FTP工作原理"></a>FTP工作原理</h3><h4 id="FTP是什么"><a href="#FTP是什么" class="headerlink" title="FTP是什么"></a>FTP是什么</h4><p>FTP（File Transfer Protocol）</p><p>文件传输协议，是支持Internet文件传输的各种规则所组成的集合，这些规则使Internet用户可以把文件从一台主机拷贝到另一台主机上，</p><p>除此之外，FTP还提供登录、目录查询以及其他会话控制等功能</p><p>说人话：FTP文件传输协议就是一个在网络中上传下载文件的一套规则</p><h4 id="FTP的工作原理"><a href="#FTP的工作原理" class="headerlink" title="FTP的工作原理"></a>FTP的工作原理</h4><p>划重点：FTP的本质是TCP通信</p><p>通过FTP传输文件，双发至少需要建立两个TCP连接</p><p>一个称为控制连接，用于传输FTP命令</p><p>一个称为数据连接，用于传输文件数据</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242123585.png" alt="image-20220521174749538"></p><p>FTP的数据连接和控制连接方向一般是相反的</p><p>举例说明：</p><p>用户使用FTP客户端连接FTP服务区请求下载文件</p><p>控制连接方向：客户端主动连接服务器告知其下载命令</p><p>数据连接方向：服务端主动连接客户端下发数据</p><p>当客户端和FTP服务器建立控制连接后</p><p>需要告诉服务器采用那种传输模式</p><p>1.主动模式(Port模式)：服务器主动连接客户端，然后传输文件</p><p>2.被动模式(Passive模式)：客户端主动连接服务器，即控制连接和数据连接都由客户端发起</p><p>一般情况下主动模式会受到客户端防火墙影响，所以被动模式使用较多</p><p>在使用FTP进行数据传输时，有两种数据传输方式</p><p>1.ASCII传输方式</p><p>以ASCII编码方式传输数据，适用于传输，仅包含英文的命令和参数或者英文文本文件</p><p>2.二进制传输方式（建议使用该方式）</p><p>可以指定采用哪种编码传输命令和文件数据，如果传输的文件不是英文文件则应该采用该方式</p><p>一般情况下，使用FTP传输文件时，客户端必须先登录服务器，获得相应权限后才能上传或下载文件</p><p>服务器也可以允许用户匿名登录FTP，不需要都拥有一个合法账号</p><p>在实际学习过程中，我们并不需要利用FTP原理来实现FTP通信，FTP工作原理相关知识点，主要做了解</p><p>C#中实现了FTP通信需要用到的相关类</p><p>FtpWebRequest、FtpWebResponse、NetworkCredential</p><h3 id="搭建FTP服务器"><a href="#搭建FTP服务器" class="headerlink" title="搭建FTP服务器"></a>搭建FTP服务器</h3><p>在实际商业项目开发当中，如果需要用FTP来进行文件传输，那么FTP服务器的解决方案都是由后端程序员来完成的，不管它使用哪种方式来搭建FTP服务器，只要能正常上传下载内容并且保证安全性即可</p><p>可以使用Serv-U，具体方式自行百度</p><h3 id="FTP相关API"><a href="#FTP相关API" class="headerlink" title="FTP相关API"></a>FTP相关API</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region NetworkCredential类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//NetworkCredential通信凭证类</span></span><br><span class="line"><span class="comment">//用于在Ftp文件传输时，设置账号密码</span></span><br><span class="line">NetworkCredential n = <span class="keyword">new</span> <span class="built_in">NetworkCredential</span>(<span class="string">&quot;liuyingbo&quot;</span>, <span class="string">&quot;liuyingbo123&quot;</span>);</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region FtpWebRequest类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//Ftp文件传输协议客户端操作类</span></span><br><span class="line"><span class="comment">//主要用于：上传、下载、删除服务器上的文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重要方法</span></span><br><span class="line"><span class="comment">//1.Create 创建新的WebRequest，用于进行Ftp相关操作</span></span><br><span class="line">FtpWebRequest req = FtpWebRequest.<span class="built_in">Create</span>(<span class="keyword">new</span> <span class="built_in">Uri</span>(<span class="string">&quot;ftp://127.0.0.1/Test.txt&quot;</span>)) as FtpWebRequest;</span><br><span class="line"><span class="comment">//2.Abort  如果正在进行文件传输，用此方法可以终止传输</span></span><br><span class="line">req.<span class="built_in">Abort</span>();</span><br><span class="line"><span class="comment">//3.GetRequestStream  获取用于上传的流</span></span><br><span class="line">Stream s = req.<span class="built_in">GetRequestStream</span>();</span><br><span class="line"><span class="comment">//4.GetResponse  返回FTP服务器响应</span></span><br><span class="line"><span class="comment">//FtpWebResponse res = req.GetResponse() as FtpWebResponse;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重要成员</span></span><br><span class="line"><span class="comment">//1.Credentials 通信凭证，设置为NetworkCredential对象</span></span><br><span class="line">req.Credentials = n;</span><br><span class="line"><span class="comment">//2.KeepAlive bool值，当完成请求时是否关闭到FTP服务器的控制连接（默认为true，不关闭）</span></span><br><span class="line">req.KeepAlive = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//3.Method  操作命令设置</span></span><br><span class="line"><span class="comment">//  WebRequestMethods.Ftp类中的操作命令属性</span></span><br><span class="line"><span class="comment">//  DeleteFile  删除文件</span></span><br><span class="line"><span class="comment">//  DownloadFile    下载文件    </span></span><br><span class="line"><span class="comment">//  ListDirectory   获取文件简短列表</span></span><br><span class="line"><span class="comment">//  ListDirectoryDetails    获取文件详细列表</span></span><br><span class="line"><span class="comment">//  MakeDirectory   创建目录</span></span><br><span class="line"><span class="comment">//  RemoveDirectory 删除目录</span></span><br><span class="line"><span class="comment">//  UploadFile  上传文件</span></span><br><span class="line">req.Method = WebRequestMethods.Ftp.DownloadFile;</span><br><span class="line"><span class="comment">//4.UseBinary 是否使用2进制传输</span></span><br><span class="line">req.UseBinary = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//5.RenameTo    重命名</span></span><br><span class="line"><span class="comment">//req.RenameTo = &quot;myTest.txt&quot;;</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region FtpWebResponse类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//它是用于封装FTP服务器对请求的响应</span></span><br><span class="line"><span class="comment">//它提供操作状态以及从服务器下载数据</span></span><br><span class="line"><span class="comment">//我们可以通过FtpWebRequest对象中的GetResponse()方法获取</span></span><br><span class="line"><span class="comment">//当使用完毕时，要使用Close释放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过它来真正的从服务器获取内容</span></span><br><span class="line">FtpWebResponse res = req.<span class="built_in">GetResponse</span>() as FtpWebResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重要方法：</span></span><br><span class="line"><span class="comment">//1.Close:释放所有资源</span></span><br><span class="line">res.<span class="built_in">Close</span>();</span><br><span class="line"><span class="comment">//2.GetResponseStream：返回从FTP服务器下载数据的流</span></span><br><span class="line">Stream stream = res.<span class="built_in">GetResponseStream</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//重要成员：</span></span><br><span class="line"><span class="comment">//1.ContentLength:接受到数据的长度</span></span><br><span class="line"><span class="built_in">print</span>(res.ContentLength);</span><br><span class="line"><span class="comment">//2.ContentType：接受数据的类型</span></span><br><span class="line"><span class="built_in">print</span>(res.ContentType);</span><br><span class="line"><span class="comment">//3.StatusCode:FTP服务器下发的最新状态码</span></span><br><span class="line"><span class="built_in">print</span>(res.StatusCode);</span><br><span class="line"><span class="comment">//4.StatusDescription:FTP服务器下发的状态代码的文本</span></span><br><span class="line"><span class="built_in">print</span>(res.StatusDescription);</span><br><span class="line"><span class="comment">//5.BannerMessage:登录前建立连接时FTP服务器发送的消息</span></span><br><span class="line"><span class="built_in">print</span>(res.BannerMessage);</span><br><span class="line"><span class="comment">//6.ExitMessage:FTP会话结束时服务器发送的消息</span></span><br><span class="line"><span class="comment">//7.LastModified:FTP服务器上的文件的上次修改日期和时间</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//通过C#提供的这3个类</span></span><br><span class="line"><span class="comment">//我们便可以完成客户端向FTP服务器</span></span><br><span class="line"><span class="comment">//操作文件的需求，比如</span></span><br><span class="line"><span class="comment">//上传、下载、删除文件</span></span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h2 id="超文本传输协议HTTP"><a href="#超文本传输协议HTTP" class="headerlink" title="超文本传输协议HTTP"></a>超文本传输协议HTTP</h2><h3 id="HTTP工作原理"><a href="#HTTP工作原理" class="headerlink" title="HTTP工作原理"></a>HTTP工作原理</h3><h4 id="HTTP是什么"><a href="#HTTP是什么" class="headerlink" title="HTTP是什么"></a>HTTP是什么</h4><p>HTTP（HyperText Transfer Protocol）</p><p>超文本传输协议，是因特网上应用最为广泛的一种网络传输协议。最初设计HTTP的，目的是为了提供一种发布和接收由文本文件组成的HTML页面的方法，后来发展到除了文本数据外，还可以传输图片、音频、视频、压缩文件以及各种程序文件等。</p><p>HTTP主要用于超文本传输，因此相对FTP显得更简单一些，目前常见的HTTP标准是HTTP/1.1.</p><p>说人话：HTTP超文本传输协议就是一个在网络中上传下载文件的一套规则</p><h4 id="HTTP的工作原理"><a href="#HTTP的工作原理" class="headerlink" title="HTTP的工作原理"></a>HTTP的工作原理</h4><p>划重点：HTTP的本质也是TCP通信</p><p>HTTP定义了Web客户端（一般指浏览器）如何从Web服务器请求Web页面，以及服务器如何把Web页面传送给客户端。</p><p>HTTP客户端首先与服务器建立TCP连接，然后客户端通过套接字发送HTTP请求，并通过套接字接收HTTP响应，由于HTTP采用TCP传输数据，因此不会丢包、不会乱序。</p><p>HTTP的工作原理主要有以下三个特点</p><h5 id="HTTP是以TCP方式工作"><a href="#HTTP是以TCP方式工作" class="headerlink" title="HTTP是以TCP方式工作"></a>HTTP是以TCP方式工作</h5><p>在HTTP/1.0中，客户端和服务器建立TCP连接后，发送一个请求到服务器，服务器发送一个应答给客户端，然后立即断开TCP连接，他们的主要步骤为：</p><p>1.客户端与服务端建立TCP连接</p><p>2.客户端向服务端发出请求</p><p>3.若服务端接受请求，则回送响应码和所需的信息</p><p>4.客户端与服务端断开TCP连接</p><p>需要注意，HTTP/1.1 支持持久连接，即客户端和服务端建立连接后，可以发送请求和接收应答，然后迅速地发送另一个请求和接收另一个应答。</p><p>持久连接也使得在得到上一个请求的应答之前能够发送多个请求，这就是HTTP/1.1与HTTP/1.0的明显不同之处，除此之外，HTTP/1.1可以发送的请求类型也比HTTP/1.0多。</p><p>目前市面上的Web服务器软件和浏览器软件基本都是支持HTTP/1.1版本的，目前使用的基本上都是HTTP/1.1版本</p><h5 id="HTTP是无状态的"><a href="#HTTP是无状态的" class="headerlink" title="HTTP是无状态的"></a>HTTP是无状态的</h5><p>无状态指：客户端发送一次请求后，服务端并没有存储关于该客户端的任何状态信息，即使客户端再次请求同一个对象，服务端仍会重新发送这个对象，不会在意之前是否已经向客户端发送过这个对象</p><p>说人话：HTTP通信就是客户端要什么来什么，想要多少来多少，服务端不会因为你要过了而不给你，不会记录你要过的状态</p><h5 id="HTTP使用元信息作为标头"><a href="#HTTP使用元信息作为标头" class="headerlink" title="HTTP使用元信息作为标头"></a>HTTP使用元信息作为标头</h5><p>HTTP通过添加标头（header）的方式向服务端提供本次HTTP请求的相关信息，即在主要数据前添加一部分额外信息，称为元信息（metainformation）元信息里主要包含：传送的对象属于哪种类型，采用的是哪种编码等等</p><p>说人话：HTTP的元信息标头，类似我们讲解Socket通信时用于区分消息类型、处理分包黏包时，在消息体前方加的自定义信息。在HTTP协议中，它也定义了类似的规则，在头部包含了一些额外信息</p><h4 id="HTTP协议的请求类型和响应状态码"><a href="#HTTP协议的请求类型和响应状态码" class="headerlink" title="HTTP协议的请求类型和响应状态码"></a>HTTP协议的请求类型和响应状态码</h4><p>请求类型：</p><p>HTTP/1.0中：</p><p>GET、POST、HEAD</p><p>HTTP/1.1中：</p><p>GET、POST、HEAD、PUT、DELETE、OPTIONS、TRACE、CONNECT</p><p>响应状态码：</p><p>1xx、2xx、3xx、4xx、5xx</p><div class="table-container"><table><thead><tr><th>请求方法名说明</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>请求获取特定的资源，比如请求一个Web页面或请求获取一个资源</td></tr><tr><td>POST</td><td>请求提交数据进行处理，比如请求上传一个文件</td></tr><tr><td>HEAD</td><td>请求获取和GET一致的内容，但是不会返回具体内容，只会返回消息头</td></tr><tr><td>PUT</td><td>向指定位置上传最新内容</td></tr><tr><td>DELETE</td><td>删除指定资源</td></tr><tr><td>OPTIONS</td><td>返回服务器针对特定资源支持的HTTP请求方法</td></tr><tr><td>TRACE</td><td>回显服务端收到的请求</td></tr><tr><td>CONNECT</td><td>预留给能够将连接改为管道方式的代理服务器</td></tr></tbody></table></div><p>每一种请求方法，其实就是在HTTP请求的头部信息包含的内容不同而已内容发送的格式为：</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242131363.png" alt="image-20221124213110318"></p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242131974.png" alt="image-20221124213118941"></p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242131611.png" alt="image-20221124213123578"></p><p>客户端向服务端发送请求后，服务端会返回HTTP响应</p><p>HTTP响应的一般格式为：</p><p><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242131203.png" alt="image-20221124213152161"></p><p>状态行中主要内容有：</p><p>\1. HTTP版本号</p><p>\2. 3位数字组成的状态码</p><p>1xx消息：请求已被服务端接收，继续处理</p><p>2xx成功：请求已成功被服务端理解并接收</p><p>3xx重定向：需要后续操作才能完成这一请求</p><p>4xx请求错误：请求含有语法错误或者无法被执行</p><p>5xx服务器错误：服务端在处理某个正确请求时发生错误</p><div class="table-container"><table><thead><tr><th>编号</th><th>状态码</th><th>说明</th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>找到资源，一切正常</td></tr><tr><td>304</td><td>NOT MODIFIED</td><td>资源在上次请求后没有任何修改（常用语缓存机制）</td></tr><tr><td>401</td><td>UNAUTHORIZED</td><td>客户端无权访问该资源，通常需要输入用户名和密码</td></tr><tr><td>403</td><td>FORBIDDEN</td><td>客户端未授权，通常是401后输入了错误用户名密码</td></tr><tr><td>404</td><td>NOT FOUND</td><td>指定位置不存在申请的资源</td></tr><tr><td>405</td><td>Method Not Allowed</td><td>不支持请求的方法</td></tr><tr><td>501</td><td>Not Implemented</td><td>服务器不能识别请求或者没有实现指定的请求</td></tr></tbody></table></div><h3 id="搭建HTTP服务器"><a href="#搭建HTTP服务器" class="headerlink" title="搭建HTTP服务器"></a>搭建HTTP服务器</h3><p>www.baidu.com</p><h3 id="C-中HTTP类"><a href="#C-中HTTP类" class="headerlink" title="C#中HTTP类"></a>C#中HTTP类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region HttpWebRequest类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//HttpWebRequest是主要用于发送客户端请求的类</span></span><br><span class="line"><span class="comment">//主要用于：发送HTTP客户端请求给服务器，可以进行消息通信、上传、下载等等操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重要方法</span></span><br><span class="line"><span class="comment">//1.Create 创建新的WebRequest，用于进行HTTP相关操作</span></span><br><span class="line">HttpWebRequest req = HttpWebRequest.<span class="built_in">Create</span>(<span class="keyword">new</span> <span class="built_in">Uri</span>(<span class="string">&quot;http://192.168.50.109:8000/Http_Server/&quot;</span>)) as HttpWebRequest;</span><br><span class="line"><span class="comment">//2.Abort  如果正在进行文件传输，用此方法可以终止传输 </span></span><br><span class="line">req.<span class="built_in">Abort</span>();</span><br><span class="line"><span class="comment">//3.GetRequestStream  获取用于上传的流</span></span><br><span class="line">Stream s = req.<span class="built_in">GetRequestStream</span>();</span><br><span class="line"><span class="comment">//4.GetResponse  返回HTTP服务器响应</span></span><br><span class="line">HttpWebResponse res = req.<span class="built_in">GetResponse</span>() as HttpWebResponse;</span><br><span class="line"><span class="comment">//5.Begin/EndGetRequestStream 异步获取用于上传的流</span></span><br><span class="line"><span class="comment">//req.BeginGetRequestStream()</span></span><br><span class="line"><span class="comment">//6.Begin/EndGetResponse 异步获取返回的HTTP服务器响应</span></span><br><span class="line"><span class="comment">//req.BeginGetResponse()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重要成员</span></span><br><span class="line"><span class="comment">//1.Credentials 通信凭证，设置为NetworkCredential对象</span></span><br><span class="line">req.Credentials = <span class="keyword">new</span> <span class="built_in">NetworkCredential</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//2.PreAuthenticate 是否随请求发送一个身份验证标头,一般需要进行身份验证时需要将其设置为true</span></span><br><span class="line">req.PreAuthenticate = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.Headers 构成标头的名称/值对的集合</span></span><br><span class="line"><span class="comment">//req.Headers</span></span><br><span class="line"><span class="comment">//4.ContentLength 发送信息的字节数 上传信息时需要先设置该内容长度</span></span><br><span class="line">req.ContentLength = <span class="number">100</span>;</span><br><span class="line"><span class="comment">//5.ContentType 在进行POST请求时，需要对发送的内容进行内容类型的设置</span></span><br><span class="line"><span class="comment">//6.Method  操作命令设置</span></span><br><span class="line"><span class="comment">//  WebRequestMethods.Http类中的操作命令属性</span></span><br><span class="line"><span class="comment">//  Get     获取请求，一般用于获取数据</span></span><br><span class="line"><span class="comment">//  Post    提交请求，一般用于上传数据，同时可以获取</span></span><br><span class="line"><span class="comment">//  Head    获取和Get一致的内容，只是只会返回消息头，不会返回具体内容</span></span><br><span class="line"><span class="comment">//  Put     向指定位置上传最新内容</span></span><br><span class="line"><span class="comment">//  Connect 表示与代理一起使用的 HTTP CONNECT 协议方法，该代理可以动态切换到隧道</span></span><br><span class="line"><span class="comment">//  MkCol   请求在请求 URI（统一资源标识符）指定的位置新建集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//了解该类的更多信息</span></span><br><span class="line"><span class="comment">//https://docs.microsoft.com/zh-cn/dotnet/api/system.net.httpwebrequest?view=net-6.0</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region HttpWebResponse类</span></span><br><span class="line"><span class="comment">//命名空间：System.Net</span></span><br><span class="line"><span class="comment">//它主要用于获取服务器反馈信息的类</span></span><br><span class="line"><span class="comment">//我们可以通过HttpWebRequest对象中的GetResponse()方法获取</span></span><br><span class="line"><span class="comment">//当使用完毕时，要使用Close释放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重要方法：</span></span><br><span class="line"><span class="comment">//1.Close:释放所有资源</span></span><br><span class="line"><span class="comment">//2.GetResponseStream：返回从FTP服务器下载数据的流</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重要成员：</span></span><br><span class="line"><span class="comment">//1.ContentLength:接受到数据的长度</span></span><br><span class="line"><span class="comment">//2.ContentType：接受数据的类型</span></span><br><span class="line"><span class="comment">//3.StatusCode:HTTP服务器下发的最新状态码</span></span><br><span class="line"><span class="comment">//4.StatusDescription:HTTP服务器下发的状态代码的文本</span></span><br><span class="line"><span class="comment">//5.BannerMessage:登录前建立连接时HTTP服务器发送的消息</span></span><br><span class="line"><span class="comment">//6.ExitMessage:HTTP会话结束时服务器发送的消息</span></span><br><span class="line"><span class="comment">//7.LastModified:HTTP服务器上的文件的上次修改日期和时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//了解该类的更多信息</span></span><br><span class="line"><span class="comment">//https://docs.microsoft.com/zh-cn/dotnet/api/system.net.httpwebresponse?view=net-6.0</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region NetworkCredential、Uri、Stream、FileStream类</span></span><br><span class="line"><span class="comment">//这些类我们在学习Ftp时已经使用过了</span></span><br><span class="line"><span class="comment">//在HTTP通讯时使用方式不变</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//Http相关通讯类的使用和Ftp非常类似</span></span><br><span class="line"><span class="comment">//只有一些细节上的区别</span></span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h4 id="Get和Post的区别"><a href="#Get和Post的区别" class="headerlink" title="Get和Post的区别"></a>Get和Post的区别</h4><p>Get — 一般从指定的资源请求数据,主要用于获取数据</p><p>Post — 一般向指定的资源提交想要被处理的数据，主要用于上传数据</p><p>相同点:</p><p>Get和Post都可以传递一些额外的参数数据给服务端</p><p>不同点:</p><p>1.在传递参数时，Post相对Get更加的安全，因为Post看不到参数<br>Get传递的参数都包含在连接中（URL资源定位地址），是暴露式的 ?参数名=参数值&amp;参数名=参数值<br>Post传递的参数放在请求数据中，不会出现在URL中，是隐藏式的</p><p>2.Get在传递数据时有大小的限制，因为它主要是在连接中拼接参数，而URL的长度是有限制的（最大长度一般为2048个字符）<br>Post在传递数据时没有限制</p><p>3.在浏览器中Get请求能被缓存，Post不能缓存</p><p>4.传输次数可能不同<br>Get: 建立连接——&gt;请求行、请求头、请求数据一次传输——&gt;获取响应——&gt;断开连接<br>Post: 建立连接——&gt;传输可能分两次——&gt;请求行，请求头第一次传输——&gt;请求数据第二次传输——&gt;获取响应——&gt;断开</p><p>但是由于他们的这些特点<br>我们在实际使用时建议Get用于获取，Post用于上传<br>如果想要传递一些不想暴露在外部的参数信息，建议使用Post，它更加的安全</p><h4 id="Post如何携带额外参数"><a href="#Post如何携带额外参数" class="headerlink" title="Post如何携带额外参数"></a>Post如何携带额外参数</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region Post如何携带额外参数</span></span><br><span class="line"><span class="comment">//关键点：将Content-Type设置为 application/x-www-form-urlencoded 键值对类型</span></span><br><span class="line">HttpWebRequest req = HttpWebRequest.<span class="built_in">Create</span>(<span class="string">&quot;http://192.168.50.109:8000/Http_Server/&quot;</span>) as HttpWebRequest;</span><br><span class="line">req.Method = WebRequestMethods.Http.Post;</span><br><span class="line">req.Timeout = <span class="number">2000</span>;</span><br><span class="line"><span class="comment">//设置上传的内容的类型</span></span><br><span class="line">req.ContentType = <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//我们要上传的数据</span></span><br><span class="line">string str = <span class="string">&quot;Name=liuyingbo&amp;ID=2&quot;</span>;</span><br><span class="line">byte[] bytes = Encoding.UTF8.<span class="built_in">GetBytes</span>(str);</span><br><span class="line"><span class="comment">//我们在上传之前一定要设置内容的长度</span></span><br><span class="line">req.ContentLength = bytes.Length;</span><br><span class="line"><span class="comment">//上传数据</span></span><br><span class="line">Stream stream = req.<span class="built_in">GetRequestStream</span>();</span><br><span class="line">stream.<span class="built_in">Write</span>(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">stream.<span class="built_in">Close</span>();</span><br><span class="line"><span class="comment">//发送数据 得到响应结果</span></span><br><span class="line">HttpWebResponse res = req.<span class="built_in">GetResponse</span>() as HttpWebResponse;</span><br><span class="line"><span class="built_in">print</span>(res.StatusCode);</span><br><span class="line"></span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h4 id="ContentType类型"><a href="#ContentType类型" class="headerlink" title="ContentType类型"></a>ContentType类型</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region ContentType的常用类型</span></span><br><span class="line"><span class="comment">//ContentType的构成：</span></span><br><span class="line"><span class="comment">//内容类型;charset=编码格式;boundary=边界字符串</span></span><br><span class="line"><span class="comment">//text/html;charset=utf-8;boundary=自定义字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//其中内容类型有：</span></span><br><span class="line"><span class="comment">//文本类型text：</span></span><br><span class="line"><span class="comment">//text/plain 没有特定子类型就是它（重要）</span></span><br><span class="line"><span class="comment">//text/html</span></span><br><span class="line"><span class="comment">//text/css</span></span><br><span class="line"><span class="comment">//text/javascript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//图片类型image：</span></span><br><span class="line"><span class="comment">//image/gif</span></span><br><span class="line"><span class="comment">//image/png</span></span><br><span class="line"><span class="comment">//image/jpeg</span></span><br><span class="line"><span class="comment">//image/bm</span></span><br><span class="line"><span class="comment">//image/webp</span></span><br><span class="line"><span class="comment">//image/x-icon</span></span><br><span class="line"><span class="comment">//image/vnd.microsoft.icon</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//音频类型audio：</span></span><br><span class="line"><span class="comment">//audio/midi</span></span><br><span class="line"><span class="comment">//audio/mpeg</span></span><br><span class="line"><span class="comment">//audio/webm</span></span><br><span class="line"><span class="comment">//audio/ogg</span></span><br><span class="line"><span class="comment">//audio/wav</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//视频类型video:</span></span><br><span class="line"><span class="comment">//video/webm</span></span><br><span class="line"><span class="comment">//video/ogg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//二进制类型application:</span></span><br><span class="line"><span class="comment">//application/octet-stream 没有特定子类型就是它（重要）</span></span><br><span class="line"><span class="comment">//application/x-www-form-urlencoded 传递参数时使用键值对形式（重要）</span></span><br><span class="line"><span class="comment">//application/pkcs12</span></span><br><span class="line"><span class="comment">//application/xhtml+xml</span></span><br><span class="line"><span class="comment">//application/xml</span></span><br><span class="line"><span class="comment">//application/pdf</span></span><br><span class="line"><span class="comment">//application/vnd.mspowerpoint</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//复合内容multipart:</span></span><br><span class="line"><span class="comment">//multipart/form-data  复合内容，有多种内容组合（重要）</span></span><br><span class="line"><span class="comment">//multipart/byteranges  特殊的复合文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//关于ContentType更多内容可以前往</span></span><br><span class="line"><span class="comment">//https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type</span></span><br><span class="line"><span class="comment">//关于媒体类型可以前往</span></span><br><span class="line"><span class="comment">//https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region ContentType中对于我们来说重要的类型</span></span><br><span class="line"><span class="comment">//1.通用2进制类型</span></span><br><span class="line"><span class="comment">//application/octet-stream</span></span><br><span class="line"><span class="comment">//2.通用文本类型</span></span><br><span class="line"><span class="comment">//text/plain </span></span><br><span class="line"><span class="comment">//3.键值对参数</span></span><br><span class="line"><span class="comment">//application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">//4.复合类型（传递的信息有多种类型组成,比如有键值对参数,有文件信息等等,上传资源服务器时需要用该类型）</span></span><br><span class="line"><span class="comment">//multipart/form-data</span></span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure><h3 id="Unity中的HTTP类"><a href="#Unity中的HTTP类" class="headerlink" title="Unity中的HTTP类"></a>Unity中的HTTP类</h3><h4 id="WWW类"><a href="#WWW类" class="headerlink" title="WWW类"></a>WWW类</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region WWW类的作用</span></span><br><span class="line"><span class="comment">//WWW是Unity提供给我们简单的访问网页的类</span></span><br><span class="line"><span class="comment">//我们可以通过该类下载和上传一些数据</span></span><br><span class="line"><span class="comment">//在使用http协议时，默认的请求类型是Get，如果想要Post上传，需要配合下节课学习的WWWFrom类使用</span></span><br><span class="line"><span class="comment">//它主要支持的协议</span></span><br><span class="line"><span class="comment">//1.http://和https:// 超文本传输协议</span></span><br><span class="line"><span class="comment">//2.ftp:// 文件传输协议（但仅限于匿名下载）</span></span><br><span class="line"><span class="comment">//3.file:// 本地文件传输协议，可以使用该协议异步加载本地文件（PC、IOS、Android都支持）</span></span><br><span class="line"><span class="comment">//我们本节课主要学习利用WWW来进行数据的下载或加载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//1.该类一般配合协同程序使用</span></span><br><span class="line"><span class="comment">//2.该类在较新Unity版本中会提示过时，但是仍可以使用，新版本将其功能整合进了UnityWebRequest类（之后讲解）</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region WWW类的常用方法和变量</span></span><br><span class="line"><span class="meta">#region 常用方法</span></span><br><span class="line"><span class="comment">//1.WWW：构造函数，用于创建一个WWW请求</span></span><br><span class="line">WWW www = <span class="keyword">new</span> <span class="built_in">WWW</span>(<span class="string">&quot;http://192.168.50.109:8000/Http_Server/test.jpg&quot;</span>);</span><br><span class="line"><span class="comment">//2.GetAudioClip：从下载数据返回一个音效切片AudioClip对象</span></span><br><span class="line"><span class="comment">//www.GetAudioClip()</span></span><br><span class="line"><span class="comment">//3.LoadImageIntoTexture：用下载数据中的图像来替换现有的一个Texture2D对象</span></span><br><span class="line"><span class="comment">//Texture2D tex = new Texture2D(100, 100);</span></span><br><span class="line"><span class="comment">//www.LoadImageIntoTexture(tex);</span></span><br><span class="line"><span class="comment">//4.LoadFromCacheOrDownload：从缓存加载AB包对象，如果该包不在缓存则自动下载存储到缓存中，以便以后直接从本地缓存中加载</span></span><br><span class="line"><span class="comment">//WWW.LoadFromCacheOrDownload(&quot;http://192.168.50.109:8000/Http_Server/test.assetbundle&quot;, 1);</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 常用变量</span></span><br><span class="line"><span class="comment">//1.assetBundle：如果加载的数据是AB包，可以通过该变量直接获取加载结果</span></span><br><span class="line"><span class="comment">//www.assetBundle</span></span><br><span class="line"><span class="comment">//2.audioClip：如果加载的数据是音效切片文件，可以通过该变量直接获取加载结果</span></span><br><span class="line"><span class="comment">//www.GetAudioClip</span></span><br><span class="line"><span class="comment">//3.bytes：以字节数组的形式获取加载到的内容</span></span><br><span class="line"><span class="comment">//www.bytes</span></span><br><span class="line"><span class="comment">//4.bytesDownloaded：过去已下载的字节数</span></span><br><span class="line"><span class="comment">//www.bytesDownloaded</span></span><br><span class="line"><span class="comment">//5.error：返回一个错误消息，如果下载期间出现错误，可以通过它获取错误信息</span></span><br><span class="line"><span class="comment">//www.error != null</span></span><br><span class="line"><span class="comment">//6.isDone：判断下载是否已经完成</span></span><br><span class="line"><span class="comment">//www.isDone</span></span><br><span class="line"><span class="comment">//7.movie：如果下载的视频，可以获取一个MovieTexture类型结果</span></span><br><span class="line"><span class="comment">//www.GetMovieTexture()</span></span><br><span class="line"><span class="comment">//8.progress:下载进度</span></span><br><span class="line"><span class="comment">//www.progress</span></span><br><span class="line"><span class="comment">//9.text：如果下载的数据是字符串，以字符串的形式返回内容</span></span><br><span class="line"><span class="comment">//www.text</span></span><br><span class="line"><span class="comment">//10.texture：如果下载的数据是图片，以Texture2D的形式返回加载结果</span></span><br><span class="line"><span class="comment">//www.texture</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 利用WWW类来异步下载或加载文件</span></span><br><span class="line"><span class="meta">#region 1.下载HTTP服务器上的内容</span></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">DownLoadHttp</span>());</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 2.下载FTP服务器上的内容（FTP服务器一定要支持匿名账户）</span></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">DownLoadFtp</span>());</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 3.本地内容加载（一般移动平台加载数据都会使用该方式）</span></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">DownLoadLocal</span>());</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//Unity中的WWW类比使用C#中的Http相关类更加的方便</span></span><br><span class="line"><span class="comment">//建议大家使用Unity当中为我们封装好的类来处理下载、加载相关逻辑</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">DownLoadHttp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.创建WWW对象</span></span><br><span class="line">    WWW www = <span class="keyword">new</span> <span class="built_in">WWW</span>(<span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi2.hdslb.com%2Fbfs%2Farchive%2F8cc2b9a7868b266800f98d42fc5d257021e75103.jpg&amp;refer=http%3A%2F%2Fi2.hdslb.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1654745686&amp;t=b7691b6e546367610e4331039d1a10ec&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.就是等待加载结束</span></span><br><span class="line">    <span class="keyword">while</span> (!www.isDone)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">print</span>(www.bytesDownloaded);</span><br><span class="line">        <span class="built_in">print</span>(www.progress);</span><br><span class="line">        yield <span class="keyword">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(www.bytesDownloaded);</span><br><span class="line">    <span class="built_in">print</span>(www.progress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.使用加载结束后的资源</span></span><br><span class="line">    <span class="keyword">if</span> (www.error == null)</span><br><span class="line">    &#123;</span><br><span class="line">        image.texture = www.texture;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(www.error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">DownLoadFtp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.创建WWW对象</span></span><br><span class="line">    WWW www = <span class="keyword">new</span> <span class="built_in">WWW</span>(<span class="string">&quot;ftp://127.0.0.1/test.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.就是等待加载结束</span></span><br><span class="line">    <span class="keyword">while</span> (!www.isDone)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">print</span>(www.bytesDownloaded);</span><br><span class="line">        <span class="built_in">print</span>(www.progress);</span><br><span class="line">        yield <span class="keyword">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(www.bytesDownloaded);</span><br><span class="line">    <span class="built_in">print</span>(www.progress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.使用加载结束后的资源</span></span><br><span class="line">    <span class="keyword">if</span> (www.error == null)</span><br><span class="line">    &#123;</span><br><span class="line">        image.texture = www.texture;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(www.error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">DownLoadLocal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.创建WWW对象</span></span><br><span class="line">    WWW www = <span class="keyword">new</span> <span class="built_in">WWW</span>(<span class="string">&quot;file://&quot;</span> + Application.streamingAssetsPath + <span class="string">&quot;/test.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.就是等待加载结束</span></span><br><span class="line">    <span class="keyword">while</span> (!www.isDone)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">print</span>(www.bytesDownloaded);</span><br><span class="line">        <span class="built_in">print</span>(www.progress);</span><br><span class="line">        yield <span class="keyword">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(www.bytesDownloaded);</span><br><span class="line">    <span class="built_in">print</span>(www.progress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.使用加载结束后的资源</span></span><br><span class="line">    <span class="keyword">if</span> (www.error == null)</span><br><span class="line">    &#123;</span><br><span class="line">        image.texture = www.texture;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(www.error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WWWForm类"><a href="#WWWForm类" class="headerlink" title="WWWForm类"></a>WWWForm类</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region WWWFrom类的作用</span></span><br><span class="line"><span class="comment">//上节课学习了使用WWW类来下载数据</span></span><br><span class="line"><span class="comment">//如果想要使用WWW上传数据时，就需要配合WWWFrom类进行使用了</span></span><br><span class="line"><span class="comment">//而WWWFrom主要就是用于集成数据的，我们可以设置上传的参数或者2进制数据</span></span><br><span class="line"><span class="comment">//当结合WWWFrom上传数据时</span></span><br><span class="line"><span class="comment">//它主要用到的请求类型是Post</span></span><br><span class="line"><span class="comment">//它使用Http协议进行上传处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//使用WWW结合WWWFrom上传数据一般需要配合后端程序制定上传规则</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region WWWFrom类的常用方法和变量</span></span><br><span class="line"><span class="comment">//该类当中我们主要就使用方法，相关变量很少使用，我们主要就着重讲解方法</span></span><br><span class="line"><span class="comment">//1.WWWForm：构造函数</span></span><br><span class="line">WWWForm data = <span class="keyword">new</span> <span class="built_in">WWWForm</span>();</span><br><span class="line"><span class="comment">//2.AddBinaryData：添加二进制数据</span></span><br><span class="line"><span class="comment">//data.AddBinaryData()</span></span><br><span class="line"><span class="comment">//3.AddField：添加字段</span></span><br><span class="line"><span class="comment">//data.AddField()</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region WWW结合WWWFrom对象来异步上传数据</span></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">UpLoadData</span>());</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//WWW结合WWWFrom上传数据</span></span><br><span class="line"><span class="comment">//需要配合后端服务器来指定上传规则</span></span><br><span class="line"><span class="comment">//也就是说我们上传的数据，后端需要知道收到数据后应该如何处理</span></span><br><span class="line"><span class="comment">//通过这种方式我们没办法像C#类当中完成文件的上传</span></span><br><span class="line"><span class="comment">//但是该方式非常适合用于制作短连接游戏的前端网络层</span></span><br><span class="line"><span class="comment">//我们可以对WWW进行二次封装，专门用于上传自定义消息给对应的Web服务器</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">UpLoadData</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        WWWForm data = <span class="keyword">new</span> <span class="built_in">WWWForm</span>();</span><br><span class="line">        <span class="comment">//上传的数据 对应的后端程序 必须要有处理的规则 才能生效</span></span><br><span class="line">        data.<span class="built_in">AddField</span>(<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;liuyingbo&quot;</span>, Encoding.UTF8);</span><br><span class="line">        data.<span class="built_in">AddField</span>(<span class="string">&quot;Age&quot;</span>, <span class="number">99</span>);</span><br><span class="line">        data.<span class="built_in">AddBinaryData</span>(<span class="string">&quot;file&quot;</span>, File.<span class="built_in">ReadAllBytes</span>(Application.streamingAssetsPath + <span class="string">&quot;/test.png&quot;</span>), <span class="string">&quot;testtest.png&quot;</span>, <span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line"></span><br><span class="line">        WWW www = <span class="keyword">new</span> <span class="built_in">WWW</span>(<span class="string">&quot;http://192.168.50.109:8000/Http_Server/&quot;</span>, data);</span><br><span class="line"></span><br><span class="line">        yield <span class="keyword">return</span> www;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (www.error == null)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">            <span class="comment">//www.bytes</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;上传失败&quot;</span> + www.error);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UnityWebRequest"><a href="#UnityWebRequest" class="headerlink" title="UnityWebRequest"></a>UnityWebRequest</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#region UnityWebRequest是什么？</span></span><br><span class="line"><span class="comment">//UnityWebRequest是一个Unity提供的一个模块化的系统类</span></span><br><span class="line"><span class="comment">//用于构成HTTP请求和处理HTTP响应</span></span><br><span class="line"><span class="comment">//它主要目标是让Unity游戏和Web服务端进行交互</span></span><br><span class="line"><span class="comment">//它将之前WWW的相关功能都集成在了其中</span></span><br><span class="line"><span class="comment">//所以新版本中都建议使用UnityWebRequest类来代替WWW类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//它在使用上和WWW很类似</span></span><br><span class="line"><span class="comment">//主要的区别就是UnityWebRequest把下载下来的数据处理单独提取出来了</span></span><br><span class="line"><span class="comment">//我们可以根据自己的需求选择对应的数据处理对象来获取数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//1.UnityWebRequest和WWW一样，需要配合协同程序使用</span></span><br><span class="line"><span class="comment">//2.UnityWebRequest和WWW一样，支持http、ftp、file协议下载或加载资源</span></span><br><span class="line"><span class="comment">//3.UnityWebRequest能够上传文件到HTTP资源服务器</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region UnityWebRequest类的常用操作</span></span><br><span class="line"><span class="comment">//1.使用Get请求获取文本或二进制数据</span></span><br><span class="line"><span class="comment">//2.使用Get请求获取纹理数据</span></span><br><span class="line"><span class="comment">//3.使用Get请求获取AB包数据</span></span><br><span class="line"><span class="comment">//4.使用Post请求发送数据</span></span><br><span class="line"><span class="comment">//5.使用Put请求上传数据</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">LoadText</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UnityWebRequest req = UnityWebRequest.<span class="built_in">Get</span>(<span class="string">&quot;http://192.168.50.109:8000/Http_Server/test.txt&quot;</span>);</span><br><span class="line">    <span class="comment">//就会等待 服务器端响应后 断开连接后 再继续执行后面的内容</span></span><br><span class="line">    yield <span class="keyword">return</span> req.<span class="built_in">SendWebRequest</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果处理成功 结果就是成功枚举</span></span><br><span class="line">    <span class="keyword">if</span>(req.result == UnityWebRequest.Result.Success)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//文本 字符串</span></span><br><span class="line">        <span class="built_in">print</span>(req.downloadHandler.text);</span><br><span class="line">        <span class="comment">//字节数组</span></span><br><span class="line">        byte[] bytes = req.downloadHandler.data;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;字节数组长度&quot;</span> + bytes.Length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取失败:&quot;</span> + req.result + req.error + req.responseCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结 </span></span><br><span class="line"><span class="comment">//UnityWebRequest使用上和WWW类很类似</span></span><br><span class="line"><span class="comment">//我们需要注意的是</span></span><br><span class="line"><span class="comment">//1.获取文本或二进制数据时</span></span><br><span class="line"><span class="comment">//  使用UnityWebRequest.Get</span></span><br><span class="line"><span class="comment">//2.获取纹理图片数据时</span></span><br><span class="line"><span class="comment">//  使用UnityWebRequestTexture.GetTexture</span></span><br><span class="line"><span class="comment">//  以及DownloadHandlerTexture.GetContent</span></span><br><span class="line"><span class="comment">//3.获取AB包数据时</span></span><br><span class="line"><span class="comment">//  使用UnityWebRequestAssetBundle.GetAssetBundle</span></span><br><span class="line"><span class="comment">//  以及DownloadHandlerAssetBundle.GetContent</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 上传相关数据类</span></span><br><span class="line"><span class="comment">//父接口</span></span><br><span class="line"><span class="comment">//IMultipartFormSection</span></span><br><span class="line"><span class="comment">//数据相关类都继承该接口</span></span><br><span class="line"><span class="comment">//我们可以用父类装子类</span></span><br><span class="line">List&lt;IMultipartFormSection&gt; dataList = <span class="keyword">new</span> <span class="built_in">List</span>&lt;IMultipartFormSection&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类数据</span></span><br><span class="line"><span class="comment">//MultipartFormDataSection</span></span><br><span class="line"><span class="comment">//1.二进制字节数组</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormDataSection</span>(Encoding.UTF8.<span class="built_in">GetBytes</span>(<span class="string">&quot;123123123123123&quot;</span>)));</span><br><span class="line"><span class="comment">//2.字符串</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormDataSection</span>(<span class="string">&quot;12312312312312312dsfasdf&quot;</span>));</span><br><span class="line"><span class="comment">//3.参数名，参数值（字节数组，字符串），编码类型，资源类型（常用）</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormDataSection</span>(<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;liuyingbo&quot;</span>, Encoding.UTF8, <span class="string">&quot;application/....&quot;</span>));</span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormDataSection</span>(<span class="string">&quot;Msg&quot;</span>, <span class="keyword">new</span> byte[<span class="number">1024</span>], <span class="string">&quot;appl.....&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//MultipartFormFileSection</span></span><br><span class="line"><span class="comment">//1.字节数组</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(File.<span class="built_in">ReadAllBytes</span>(Application.streamingAssetsPath + <span class="string">&quot;/test.png&quot;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.文件名，字节数组（常用）</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;上传的文件.png&quot;</span>, File.<span class="built_in">ReadAllBytes</span>(Application.streamingAssetsPath + <span class="string">&quot;/test.png&quot;</span>)));</span><br><span class="line"><span class="comment">//3.字符串数据，文件名（常用）</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;12312313212312&quot;</span>, <span class="string">&quot;test.txt&quot;</span>));</span><br><span class="line"><span class="comment">//4.字符串数据，编码格式，文件名（常用）</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;12312313212312&quot;</span>, Encoding.UTF8, <span class="string">&quot;test.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.表单名，字节数组，文件名，文件类型</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;file&quot;</span>, <span class="keyword">new</span> byte[<span class="number">1024</span>], <span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line"><span class="comment">//6.表单名，字符串数据，编码格式，文件名</span></span><br><span class="line">dataList.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;file&quot;</span>, <span class="string">&quot;123123123&quot;</span>, Encoding.UTF8, <span class="string">&quot;test.txt&quot;</span>));</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 知识点二 Post发送相关</span></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">Upload</span>());</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 知识点三 Put上传相关</span></span><br><span class="line"><span class="comment">//注意：Put请求类型不是所有的web服务器都认，必须要服务器处理该请求类型那么才能有相应</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//我们可以利用Post上传数据或上传文件</span></span><br><span class="line"><span class="comment">//Put主要用于上传文件，但是必须资源服务器支持Put请求类型</span></span><br><span class="line"><span class="comment">//为了通用性，我们可以统一使用Post请求类型进行数据和资源的上传</span></span><br><span class="line"><span class="comment">//它的使用和之前的WWW类似，只要前后端制定好规则就可以相互通信了</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">Upload</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//准备上传的数据 </span></span><br><span class="line">    List&lt;IMultipartFormSection&gt; data = <span class="keyword">new</span> <span class="built_in">List</span>&lt;IMultipartFormSection&gt;();</span><br><span class="line">    <span class="comment">//键值对相关的 信息 字段数据</span></span><br><span class="line">    data.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormDataSection</span>(<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;liuyingbo&quot;</span>));</span><br><span class="line">    <span class="comment">//PlayerMsg msg = new PlayerMsg();</span></span><br><span class="line">    <span class="comment">//data.Add(new MultipartFormDataSection(&quot;Msg&quot;, msg.Writing()));</span></span><br><span class="line">    <span class="comment">//添加一些文件上传文件</span></span><br><span class="line">    <span class="comment">//传2进制文件</span></span><br><span class="line">    data.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;TestTest123.png&quot;</span>, File.<span class="built_in">ReadAllBytes</span>(Application.streamingAssetsPath + <span class="string">&quot;/test.png&quot;</span>)));</span><br><span class="line">    <span class="comment">//传文本文件</span></span><br><span class="line">    data.<span class="built_in">Add</span>(<span class="keyword">new</span> <span class="built_in">MultipartFormFileSection</span>(<span class="string">&quot;123123123123123&quot;</span>, <span class="string">&quot;Test123.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">    UnityWebRequest req = UnityWebRequest.<span class="built_in">Post</span>(<span class="string">&quot;http://192.168.50.109:8000/Http_Server/&quot;</span>, data);</span><br><span class="line"></span><br><span class="line">    req.<span class="built_in">SendWebRequest</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!req.isDone)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">print</span>(req.uploadProgress);</span><br><span class="line">        <span class="built_in">print</span>(req.uploadedBytes);</span><br><span class="line">        yield <span class="keyword">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(req.uploadProgress);</span><br><span class="line">    <span class="built_in">print</span>(req.uploadedBytes);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.result == UnityWebRequest.Result.Success)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">        <span class="comment">//req.downloadHandler.data</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;上传失败&quot;</span> + req.error + req.responseCode + req.result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#region 高级操作指什么？</span></span><br><span class="line"><span class="comment">//在常用操作中我们使用的是Unity为我们封装好的一些方法</span></span><br><span class="line"><span class="comment">//我们可以方便的进行一些指定类型的数据获取</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//比如</span></span><br><span class="line"><span class="comment">//下载数据时：</span></span><br><span class="line"><span class="comment">//1.文本和2进制</span></span><br><span class="line"><span class="comment">//2.图片</span></span><br><span class="line"><span class="comment">//3.AB包</span></span><br><span class="line"><span class="comment">//如果我们想要获取其它类型的数据应该如何处理呢？</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//上传数据时：</span></span><br><span class="line"><span class="comment">//1.可以指定参数和值</span></span><br><span class="line"><span class="comment">//2.可以上传文件</span></span><br><span class="line"><span class="comment">//如果想要上传一些基于HTTP规则的其它数据应该如何处理呢？</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//高级操作就是用来处理 常用操作不能完成的需求的</span></span><br><span class="line"><span class="comment">//它的核心思想就是：UnityWebRequest中可以将数据处理分离开</span></span><br><span class="line"><span class="comment">//比如常规操作中我们用到的</span></span><br><span class="line"><span class="comment">//DownloadHandlerTexture 和 DownloadHandlerAssetBundle两个类</span></span><br><span class="line"><span class="comment">//就是用来将2进制字节数组转换成对应类型进行处理的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//所以高级操作时指 让你按照规则来实现更多的数据获取、上传等功能</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region UnityWebRequest类的更多内容</span></span><br><span class="line"><span class="comment">//UnityWebRequest req = UnityWebRequest.Get(&quot;&quot;);</span></span><br><span class="line"><span class="comment">//UnityWebRequest req = UnityWebRequestTexture.GetTexture(&quot;&quot;);</span></span><br><span class="line"><span class="comment">//UnityWebRequest req = UnityWebRequestAssetBundle.GetAssetBundle(&quot;&quot;);</span></span><br><span class="line"><span class="comment">//UnityWebRequest req = UnityWebRequest.Put()</span></span><br><span class="line"><span class="comment">//UnityWebRequest req = UnityWebRequest.Post</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//req.isDone</span></span><br><span class="line"><span class="comment">//req.downloadProgress;</span></span><br><span class="line"><span class="comment">//req.downloadedBytes;</span></span><br><span class="line"><span class="comment">//req.uploadProgress;</span></span><br><span class="line"><span class="comment">//req.uploadedBytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//req.SendWebRequest()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//更多内容</span></span><br><span class="line"><span class="comment">//1.构造函数</span></span><br><span class="line"><span class="comment">//UnityWebRequest req = new UnityWebRequest();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.请求地址</span></span><br><span class="line"><span class="comment">//req.url = &quot;服务器地址&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.请求类型</span></span><br><span class="line"><span class="comment">//req.method = UnityWebRequest.kHttpVerbPOST;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.进度</span></span><br><span class="line"><span class="comment">//req.downloadProgress</span></span><br><span class="line"><span class="comment">//req.uploadProgress</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//5.超时设置</span></span><br><span class="line"><span class="comment">//req.timeout = 2000;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//6.上传、下载的字节数</span></span><br><span class="line"><span class="comment">//req.downloadedBytes</span></span><br><span class="line"><span class="comment">//req.uploadedBytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//7.重定向次数 设置为0表示不进行重定向 可以设置次数</span></span><br><span class="line"><span class="comment">//req.redirectLimit = 10;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//8.状态码、结果、错误内容</span></span><br><span class="line"><span class="comment">//req.result</span></span><br><span class="line"><span class="comment">//req.error</span></span><br><span class="line"><span class="comment">//req.responseCode</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//9.下载、上传处理对象</span></span><br><span class="line"><span class="comment">//req.downloadHandler</span></span><br><span class="line"><span class="comment">//req.uploadHandler</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//更多内容</span></span><br><span class="line"><span class="comment">//https://docs.unity.cn/cn/2020.3/ScriptReference/Networking.UnityWebRequest.html</span></span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 自定义获取数据DownloadHandler相关类</span></span><br><span class="line"><span class="comment">//关键类：</span></span><br><span class="line"><span class="comment">//1.DownloadHandlerBuffer 用于简单的数据存储，得到对应的2进制数据。</span></span><br><span class="line"><span class="comment">//2.DownloadHandlerFile 用于下载文件并将文件保存到磁盘（内存占用少）。</span></span><br><span class="line"><span class="comment">//3.DownloadHandlerTexture 用于下载图像。</span></span><br><span class="line"><span class="comment">//4.DownloadHandlerAssetBundle 用于提取 AssetBundle。</span></span><br><span class="line"><span class="comment">//5.DownloadHandlerAudioClip 用于下载音频文件。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">DownLoadTex</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">DownLoadAB</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//以上的这些类，其实就是Unity帮助我们实现好的，用于解析下载下来的数据的类</span></span><br><span class="line"><span class="comment">//使用对应的类处理下载数据，他们就会在内部将下载的数据处理为对应的类型，方便我们使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//DownloadHandlerScript 是一个特殊类。就其本身而言，不会执行任何操作。</span></span><br><span class="line"><span class="comment">//但是，此类可由用户定义的类继承。此类接收来自 UnityWebRequest 系统的回调，</span></span><br><span class="line"><span class="comment">//然后可以使用这些回调在数据从网络到达时执行完全自定义的数据处理。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StartCoroutine</span>(<span class="built_in">DownLoadCustomHandler</span>());</span><br><span class="line"><span class="meta">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#region 总结</span></span><br><span class="line"><span class="comment">//我们可以自己设置UnityWebRequest当中的下载处理对象</span></span><br><span class="line"><span class="comment">//当设置后，下载数据后它会使用该对象中对应的函数处理数据</span></span><br><span class="line"><span class="comment">//让我们更方便的获取我们想要的数据</span></span><br><span class="line"><span class="comment">//方便我们对数据下载或获取进行拓展</span></span><br><span class="line"><span class="meta">#endregion</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://liuyingbo.com">刘英博</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://liuyingbo.com/posts/f780d4d0.html">https://liuyingbo.com/posts/f780d4d0.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://liuyingbo.com" target="_blank">狼唤</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Unity/">Unity</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/">网络</a></div><div class="post_share"><div class="social-share" data-image="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c7963808.html"><img class="prev-cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Unity-网络开发（一）</div></div></a></div><div class="next-post pull-right"><a href="/posts/430e30ec.html"><img class="next-cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192022487.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Unity-中英对照汉化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/ba9e7782.html" title="Unity-网络开发（三）"><img class="cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-14</div><div class="title">Unity-网络开发（三）</div></div></a></div><div><a href="/posts/c7963808.html" title="Unity-网络开发（一）"><img class="cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-16</div><div class="title">Unity-网络开发（一）</div></div></a></div><div><a href="/posts/9fa0374.html" title="Unity-Shader"><img class="cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192022487.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-06</div><div class="title">Unity-Shader</div></div></a></div><div><a href="/posts/undefined.html" title="Unity-全局屏幕点击特效"><img class="cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-14</div><div class="title">Unity-全局屏幕点击特效</div></div></a></div><div><a href="/posts/b6d0915c.html" title="Unity-底层原理"><img class="cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-12</div><div class="title">Unity-底层原理</div></div></a></div><div><a href="/posts/6739242f.html" title="Unity-简易对象池"><img class="cover" src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-01</div><div class="title">Unity-简易对象池</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211100000064.JPG" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">刘英博</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/liuyingbor" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gitHub"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=liuyingbo666@qq.com" target="_blank" title="Email"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/11929004" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a><a class="social-icon faa-parent animated-hover" href="tencent://Message/?Uin=594686596&amp;amp;websiteName=local.edu.com:8888=&amp;amp;Menu=yes" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-QQ1"></use></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="toc-number">1.</span> <span class="toc-text">网络通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">网络游戏通信方案概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B1%E8%81%94%E7%BD%91%E5%92%8C%E5%BC%BA%E8%81%94%E7%BD%91%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">弱联网和强联网游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%BF%E8%BF%9E%E6%8E%A5%E5%92%8C%E7%9F%AD%E8%BF%9E%E6%8E%A5%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">长连接和短连接游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket%E3%80%81HTTP%E3%80%81FTP"><span class="toc-number">1.1.3.</span> <span class="toc-text">Socket、HTTP、FTP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80"><span class="toc-number">1.2.</span> <span class="toc-text">网络通信基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E5%92%8C%E7%AB%AF%E5%8F%A3%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">IP地址和端口类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">域名解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%962%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">序列化和反序列化2进制数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E4%B8%AD%E4%BC%A0%E8%BE%93%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">网络通信中传输的数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">字符编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%B1%E7%A0%81"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">乱码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASCII%E7%A0%81"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">ASCII码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9EASCII%E7%A0%81"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">非ASCII码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unicode"><span class="toc-number">1.2.3.6.</span> <span class="toc-text">Unicode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UTF-8"><span class="toc-number">1.2.3.7.</span> <span class="toc-text">UTF-8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.2.3.8.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.2.3.9.</span> <span class="toc-text">反序列化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97Socket"><span class="toc-number">1.3.</span> <span class="toc-text">套接字Socket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">Socket概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.2.</span> <span class="toc-text">TCP通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%9C%80%E8%A6%81%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">服务端和客户端需要做什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E5%8D%8F%E8%AE%AE%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%9A%84%E4%BD%93%E7%8E%B0"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">TCP协议三次握手的体现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E5%8D%8F%E8%AE%AE%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E7%9A%84%E4%BD%93%E7%8E%B0"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">TCP协议四次挥手的体现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E5%9F%BA%E6%9C%ACAPI"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">TCP基本API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%86%E6%B6%88%E6%81%AF"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">如何区分消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%85%E3%80%81%E9%BB%8F%E5%8C%85"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">分包、黏包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%8C%85%E3%80%81%E9%BB%8F%E5%8C%85%EF%BC%9F"><span class="toc-number">1.3.2.6.1.</span> <span class="toc-text">什么是分包、黏包？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%EF%BC%9F"><span class="toc-number">1.3.2.6.2.</span> <span class="toc-text">如何解决？</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%83%E8%B7%B3%E6%B6%88%E6%81%AF"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">心跳消息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BF%83%E8%B7%B3%E6%B6%88%E6%81%AF%EF%BC%9F"><span class="toc-number">1.3.2.7.1.</span> <span class="toc-text">什么是心跳消息？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%BF%83%E8%B7%B3%E6%B6%88%E6%81%AF%EF%BC%9F"><span class="toc-number">1.3.2.7.2.</span> <span class="toc-text">为什么需要心跳消息？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%BF%83%E8%B7%B3%E6%B6%88%E6%81%AF"><span class="toc-number">1.3.2.7.3.</span> <span class="toc-text">实现心跳消息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.3.</span> <span class="toc-text">UDP通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%9C%80%E8%A6%81%E5%81%9A%E4%BB%80%E4%B9%88-1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">服务端和客户端需要做什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E7%9B%B8%E5%AF%B9TCP%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">UDP相对TCP的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E7%9A%84%E5%88%86%E5%8C%85%E3%80%81%E9%BB%8F%E5%8C%85%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">UDP的分包、黏包问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%8C%85"><span class="toc-number">1.3.3.3.1.</span> <span class="toc-text">分包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%8C%85%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.3.3.2.</span> <span class="toc-text">分包问题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E5%9F%BA%E6%9C%ACAPI"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">UDP基本API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93FTP"><span class="toc-number">1.4.</span> <span class="toc-text">文件传输FTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FTP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.1.</span> <span class="toc-text">FTP工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">FTP是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">FTP的工作原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.4.2.</span> <span class="toc-text">搭建FTP服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FTP%E7%9B%B8%E5%85%B3API"><span class="toc-number">1.4.3.</span> <span class="toc-text">FTP相关API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AEHTTP"><span class="toc-number">1.5.</span> <span class="toc-text">超文本传输协议HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.</span> <span class="toc-text">HTTP工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">HTTP是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">HTTP的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E6%98%AF%E4%BB%A5TCP%E6%96%B9%E5%BC%8F%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.5.1.2.1.</span> <span class="toc-text">HTTP是以TCP方式工作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E6%98%AF%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84"><span class="toc-number">1.5.1.2.2.</span> <span class="toc-text">HTTP是无状态的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E4%BD%BF%E7%94%A8%E5%85%83%E4%BF%A1%E6%81%AF%E4%BD%9C%E4%B8%BA%E6%A0%87%E5%A4%B4"><span class="toc-number">1.5.1.2.3.</span> <span class="toc-text">HTTP使用元信息作为标头</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">HTTP协议的请求类型和响应状态码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAHTTP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">搭建HTTP服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E4%B8%ADHTTP%E7%B1%BB"><span class="toc-number">1.5.3.</span> <span class="toc-text">C#中HTTP类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Get%E5%92%8CPost%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">Get和Post的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Post%E5%A6%82%E4%BD%95%E6%90%BA%E5%B8%A6%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">Post如何携带额外参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ContentType%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">ContentType类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity%E4%B8%AD%E7%9A%84HTTP%E7%B1%BB"><span class="toc-number">1.5.4.</span> <span class="toc-text">Unity中的HTTP类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WWW%E7%B1%BB"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">WWW类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WWWForm%E7%B1%BB"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">WWWForm类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UnityWebRequest"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">UnityWebRequest</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/29f6.html" title="Unity-移动端屏幕适配"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242151718.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Unity-移动端屏幕适配"></a><div class="content"><a class="title" href="/posts/29f6.html" title="Unity-移动端屏幕适配">Unity-移动端屏幕适配</a><time datetime="2023-01-30T11:35:12.190Z" title="发表于 2023-01-30 11:35:12">2023-01-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4ac7.html" title="C# LINQ"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211191917907.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="C# LINQ"></a><div class="content"><a class="title" href="/posts/4ac7.html" title="C# LINQ">C# LINQ</a><time datetime="2022-11-24T22:49:16.000Z" title="发表于 2022-11-24 22:49:16">2022-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fff1.html" title="Unity-移动平台相关Java语法"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242151718.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Unity-移动平台相关Java语法"></a><div class="content"><a class="title" href="/posts/fff1.html" title="Unity-移动平台相关Java语法">Unity-移动平台相关Java语法</a><time datetime="2022-11-24T21:56:45.000Z" title="发表于 2022-11-24 21:56:45">2022-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1d0254fc.html" title="Unity-移动平台相关Android"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211242151718.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Unity-移动平台相关Android"></a><div class="content"><a class="title" href="/posts/1d0254fc.html" title="Unity-移动平台相关Android">Unity-移动平台相关Android</a><time datetime="2022-09-01T15:06:06.000Z" title="发表于 2022-09-01 15:06:06">2022-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ba9e7782.html" title="Unity-网络开发（三）"><img src="https://blog-1308267163.cos.ap-shanghai.myqcloud.com/imgs/202211192048985.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Unity-网络开发（三）"></a><div class="content"><a class="title" href="/posts/ba9e7782.html" title="Unity-网络开发（三）">Unity-网络开发（三）</a><time datetime="2022-08-14T22:13:47.000Z" title="发表于 2022-08-14 22:13:47">2022-08-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 刘英博</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.liuyingbo.com/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.liuyingbo.com/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="/js/title.js"></script><div class="aplayer no-destroy" data-id="1708664797" data-server="tencent" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true"></div><script data-pjax src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInRight"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="/js/ali_font.js"></script></body></html>